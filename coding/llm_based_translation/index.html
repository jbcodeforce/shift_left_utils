<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/shift_left_utils/coding/llm_based_translation/ rel=canonical><link href=../ rel=prev><link href=../../tracking/ rel=next><link rel=icon href=../../assets/batchy.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>AI based migration - Shift Left Utilities v0.1.44</title><link rel=stylesheet href=../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sql-translation-methodology class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Shift Left Utilities v0.1.44" class="md-header__button md-logo" aria-label="Shift Left Utilities v0.1.44" data-md-component=logo> <img src=../../assets/batchy.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Shift Left Utilities v0.1.44 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> AI based migration </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/shift_left_utils title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Shift Left Utilities v0.1.44" class="md-nav__button md-logo" aria-label="Shift Left Utilities v0.1.44" data-md-component=logo> <img src=../../assets/batchy.png alt=logo> </a> Shift Left Utilities v0.1.44 </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/shift_left_utils title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev_process/ class=md-nav__link> <span class=md-ellipsis> Development Process </span> </a> </li> <li class=md-nav__item> <a href=../../setup/ class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> <li class=md-nav__item> <a href=../../recipes/ class=md-nav__link> <span class=md-ellipsis> Recipes </span> </a> </li> <li class=md-nav__item> <a href=../../command/ class=md-nav__link> <span class=md-ellipsis> CLI References </span> </a> </li> <li class=md-nav__item> <a href=../../mcp/ class=md-nav__link> <span class=md-ellipsis> MCP server </span> </a> </li> <li class=md-nav__item> <a href=../test_harness/ class=md-nav__link> <span class=md-ellipsis> Test Harness </span> </a> </li> <li class=md-nav__item> <a href=../../pipeline_mgr/ class=md-nav__link> <span class=md-ellipsis> Pipeline Management </span> </a> </li> <li class=md-nav__item> <a href=../../blue_green_deploy/ class=md-nav__link> <span class=md-ellipsis> Blue/Green Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../perf_test/ class=md-nav__link> <span class=md-ellipsis> Performance Testing </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink-studies/coding/flink-sql/ class=md-nav__link> <span class=md-ellipsis> Flink SQL best practices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> For Contributors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> For Contributors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> AI based migration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> AI based migration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#migration-context class=md-nav__link> <span class=md-ellipsis> Migration Context </span> </a> <nav class=md-nav aria-label="Migration Context"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitations class=md-nav__link> <span class=md-ellipsis> Limitations </span> </a> </li> <li class=md-nav__item> <a href=#spark-sql-to-flink-sql class=md-nav__link> <span class=md-ellipsis> Spark SQL to Flink SQL </span> </a> </li> <li class=md-nav__item> <a href=#ksqldb-to-flink-sql class=md-nav__link> <span class=md-ellipsis> ksqlDB to Flink SQL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#current-agentic-approach class=md-nav__link> <span class=md-ellipsis> Current Agentic Approach </span> </a> </li> <li class=md-nav__item> <a href=#architecture-overview class=md-nav__link> <span class=md-ellipsis> Architecture Overview </span> </a> <nav class=md-nav aria-label="Architecture Overview"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-roles class=md-nav__link> <span class=md-ellipsis> Agent Roles </span> </a> </li> <li class=md-nav__item> <a href=#class-diagram class=md-nav__link> <span class=md-ellipsis> Class diagram </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a-test-bed class=md-nav__link> <span class=md-ellipsis> A test bed </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites-and-setup class=md-nav__link> <span class=md-ellipsis> Prerequisites and Setup </span> </a> <nav class=md-nav aria-label="Prerequisites and Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-setup class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> <li class=md-nav__item> <a href=#configuration-file-setup class=md-nav__link> <span class=md-ellipsis> Configuration File Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migration-workflow class=md-nav__link> <span class=md-ellipsis> Migration Workflow </span> </a> <nav class=md-nav aria-label="Migration Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-project-initialization class=md-nav__link> <span class=md-ellipsis> 1. Project Initialization </span> </a> </li> <li class=md-nav__item> <a href=#2-specific-setup class=md-nav__link> <span class=md-ellipsis> 2. Specific Setup </span> </a> </li> <li class=md-nav__item> <a href=#3-migration-execution class=md-nav__link> <span class=md-ellipsis> 3. Migration Execution </span> </a> </li> <li class=md-nav__item> <a href=#4-validation-and-deployment class=md-nav__link> <span class=md-ellipsis> 4. Validation and Deployment </span> </a> </li> <li class=md-nav__item> <a href=#5-prepare-for-pipeline-management class=md-nav__link> <span class=md-ellipsis> 5. Prepare for pipeline management </span> </a> </li> <li class=md-nav__item> <a href=#6-next class=md-nav__link> <span class=md-ellipsis> 6. Next </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tracking/ class=md-nav__link> <span class=md-ellipsis> Feature Tracking </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#migration-context class=md-nav__link> <span class=md-ellipsis> Migration Context </span> </a> <nav class=md-nav aria-label="Migration Context"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitations class=md-nav__link> <span class=md-ellipsis> Limitations </span> </a> </li> <li class=md-nav__item> <a href=#spark-sql-to-flink-sql class=md-nav__link> <span class=md-ellipsis> Spark SQL to Flink SQL </span> </a> </li> <li class=md-nav__item> <a href=#ksqldb-to-flink-sql class=md-nav__link> <span class=md-ellipsis> ksqlDB to Flink SQL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#current-agentic-approach class=md-nav__link> <span class=md-ellipsis> Current Agentic Approach </span> </a> </li> <li class=md-nav__item> <a href=#architecture-overview class=md-nav__link> <span class=md-ellipsis> Architecture Overview </span> </a> <nav class=md-nav aria-label="Architecture Overview"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-roles class=md-nav__link> <span class=md-ellipsis> Agent Roles </span> </a> </li> <li class=md-nav__item> <a href=#class-diagram class=md-nav__link> <span class=md-ellipsis> Class diagram </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a-test-bed class=md-nav__link> <span class=md-ellipsis> A test bed </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites-and-setup class=md-nav__link> <span class=md-ellipsis> Prerequisites and Setup </span> </a> <nav class=md-nav aria-label="Prerequisites and Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-setup class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> <li class=md-nav__item> <a href=#configuration-file-setup class=md-nav__link> <span class=md-ellipsis> Configuration File Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migration-workflow class=md-nav__link> <span class=md-ellipsis> Migration Workflow </span> </a> <nav class=md-nav aria-label="Migration Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-project-initialization class=md-nav__link> <span class=md-ellipsis> 1. Project Initialization </span> </a> </li> <li class=md-nav__item> <a href=#2-specific-setup class=md-nav__link> <span class=md-ellipsis> 2. Specific Setup </span> </a> </li> <li class=md-nav__item> <a href=#3-migration-execution class=md-nav__link> <span class=md-ellipsis> 3. Migration Execution </span> </a> </li> <li class=md-nav__item> <a href=#4-validation-and-deployment class=md-nav__link> <span class=md-ellipsis> 4. Validation and Deployment </span> </a> </li> <li class=md-nav__item> <a href=#5-prepare-for-pipeline-management class=md-nav__link> <span class=md-ellipsis> 5. Prepare for pipeline management </span> </a> </li> <li class=md-nav__item> <a href=#6-next class=md-nav__link> <span class=md-ellipsis> 6. Next </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=sql-translation-methodology>SQL Translation Methodology<a class=headerlink href=#sql-translation-methodology title="Permanent link">&para;</a></h1> <details class="- info"> <summary>Version</summary> <p>Created Dec - 2024 Updated Sept 24 - 2025</p> </details> <p>The current implementation supported by this tool enables migration of:</p> <ul> <li>dbt/Spark SQL to Flink SQL statements</li> <li>ksqlDB to Flink SQL</li> </ul> <p>The approach uses LLM agents. This document covers the methodology, setup, usage of the <code>shift_left</code> tool for automated SQL migrations, and how to extend it to get better results.</p> <p>The core idea is to leverage LLMs to understand the source SQL semantics and translate them to Flink SQL. </p> <p><strong>This is not production ready, the LLM can generate hallucinations, and one to one mapping between source like ksqlDB or Spark to Flink is sometime not the best approach.</strong> We expect that this agentic solution could be a strong foundation for better results, and can be enhanced over time.</p> <p>The implementation use the OpenAI SDK, so different LLM models can be used, as soon as they support OpenAI. The <code>qwen3:30b</code> model can be used locally using Ollama on Mac M3 Pro with 36GB RAM. Other models running remotely and supporting OpenAI APIs may be used. </p> <h2 id=migration-context>Migration Context<a class=headerlink href=#migration-context title="Permanent link">&para;</a></h2> <p>As described in the <a href=../../ >introduction</a>, at a high level, data engineers need to take a source project, define a new Flink project, perform migrations, run Flink statement deployments, manage pipelines, and write and execute tests:</p> <figure> <img alt src=../../images/components.drawio.png> <capture>Shift Left project system context</capture> </figure> <p>All those tasks are described under the <a href=../../recipes/ >recipe chapter</a> and supported by this CLI.</p> <p>For automatic migration, LLMs alone might not be sufficient to address complex translations in an automated process. Agents help by specializing in specific steps with feedback loops and retries.</p> <details class="- info"> <summary>Complexity of language translation</summary> <p>For any programming language translation, we need to start with a corpus of source code. This can be done programmatically from the source language, then for each generated code, implement the semantically equivalent Flink SQL counterparts.</p> <p>The goal of corpus creation is to identify common ksqlDB or Spark SQL constructs (joins, aggregations, window functions, UDFs, etc.), then manually translate a smaller, diverse set of queries to establish translation rules. Using these rules, we can generate permutations and variations of queries. It is crucial to test the generated Flink SQL against a test dataset to ensure semantic equivalence.</p> <p>Build query pairs to represent the source-to-target set as a corpus. For each query pair, include the relevant table schemas. This is vital for the LLM to understand data types, column names, and relationships. It is not recommended to have different prompts for different parts of a SQL statement, as the LLM's strength comes from the entire context. However, there will still be problems for SQL scripts that have many lines of code, as a 200+ line script will reach thousands of tokens.</p> <p>To improve result accuracy, it is possible to use Supervised Fine-tuning techniques:</p> <ul> <li>Fine-tune the chosen LLM on the generated code. The goal is for the LLM to learn the translation patterns and nuances between ksqlDB or Spark SQL and Flink SQL.</li> <li>Prompt Engineering: Experiment with different prompt structures during fine-tuning and inference. A good prompt will guide the LLM effectively. The current implementation leverages this type of prompt: e.g., "Translate the following Spark SQL query to Flink SQL, considering the provided schema. Ensure semantic equivalence and valid Flink syntax."</li> <li>For evaluation assessment, it is recommended to add a step to the agentic workflow to validate the syntax of the generated Flink SQL. Better validation involves assessing semantic equivalence by determining if the Flink SQL query produces the same results as the ksqlDB or Spark SQL query on a given dataset.</li> </ul> <p>For validation, it may be relevant to have a knowledge base of common translation errors. When the Validation Agent reports an error, the Refinement Agent attempts to correct the Flink SQL. It might feed the error message back to the LLM with instructions to fix it. The knowledge base should be populated with human-curated rules for common translation pitfalls.</p> <p>It may be important to explain why a translation was done a certain way to better tune prompts. For complex queries or failures, human review ("human in the loop") and correction mechanisms will be essential, with the system learning from these corrections.</p> </details> <h3 id=limitations>Limitations<a class=headerlink href=#limitations title="Permanent link">&para;</a></h3> <p>LLMs cannot magically translate custom UDFs. This will likely require manual intervention or a separate mapping mechanism. The system should identify and flag untranslatable UDFs.</p> <p>Flink excels at stateful stream processing. Spark SQL's batch orientation means that translating stateful Spark operations (if they exist) to their Flink streaming counterparts would be highly complex and would likely require significant human oversight or custom rules.</p> <h3 id=spark-sql-to-flink-sql>Spark SQL to Flink SQL<a class=headerlink href=#spark-sql-to-flink-sql title="Permanent link">&para;</a></h3> <p>While Spark SQL is primarily designed for batch processing, it can be migrated to Flink real-time processing with some refactoring and tuning. Spark also supports streaming via micro-batching. Most basic SQL operators (SELECT, FROM, WHERE, JOIN) are similar between Spark and Flink.</p> <ul> <li>Example command to migrate one Spark SQL script <div class="language-sh highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># set SRC_FOLDER to one of the spark source folder like tests/data/spark-project</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1># set STAGING to the folder target to the migrated content</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>shift_left<span class=w> </span>table<span class=w> </span>migrate<span class=w> </span>customer_journey<span class=w> </span><span class=nv>$SRC_FOLDER</span>/sources/src_customer_journey.sql<span class=w> </span><span class=nv>$STAGING</span><span class=w> </span>--source-type<span class=w> </span>spark
</span></code></pre></div></li> </ul> <p>We will review setup in <a href>this section</a>.</p> <ul> <li>When using the start schema of Kimball methodology, it is possible to process the fact tables up to their sources; the tool will migrate all tables recursively. This could take time if the dependency graph is large. We recommend at the beginning of the migration project to go one table at a time.</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>shift_left</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>migrate</span><span class=w> </span><span class=err>$</span><span class=n>SRC_FOLDER</span><span class=o>/</span><span class=n>facts</span><span class=o>/</span><span class=n>fct_examination_data</span><span class=p>.</span><span class=k>sql</span><span class=w> </span><span class=err>$</span><span class=n>STAGING</span><span class=w> </span><span class=c1>--recursive --source-type spark</span>
</span></code></pre></div> <details class="- info"> <summary>Example of Output</summary> <div class="language-sh highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>process<span class=w> </span>SQL<span class=w> </span>file<span class=w> </span>../src-dbt-project/models/facts/fct_examination_data.sql
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>Create<span class=w> </span>folder<span class=w> </span>fct_exam_data<span class=w> </span><span class=k>in</span><span class=w> </span>../flink-project/staging/facts/p1
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>---<span class=w> </span>Start<span class=w> </span>translator<span class=w> </span>AI<span class=w> </span>Agent<span class=w> </span>---
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>---<span class=w> </span>Done<span class=w> </span>translator<span class=w> </span>Agent:<span class=w> </span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>INSERT<span class=w> </span>INTO<span class=w> </span>fct_examination_data
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>...
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>---<span class=w> </span>Start<span class=w> </span>clean_sql<span class=w> </span>AI<span class=w> </span>Agent<span class=w> </span>---
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>---<span class=w> </span>Done<span class=w> </span>Clean<span class=w> </span>SQL<span class=w> </span>Agent:<span class=w> </span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>---<span class=w> </span>Start<span class=w> </span>ddl_generation<span class=w> </span>AI<span class=w> </span>Agent<span class=w> </span>---
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>---<span class=w> </span>Done<span class=w> </span>DDL<span class=w> </span>generator<span class=w> </span>Agent:
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>CREATE<span class=w> </span>TABLE<span class=w> </span>IF<span class=w> </span>NOT<span class=w> </span>EXISTS<span class=w> </span>fct_examination_data<span class=w> </span><span class=o>(</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>    </span><span class=sb>`</span>exam_id<span class=sb>`</span><span class=w> </span>STRING,
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>    </span><span class=sb>`</span>perf_id<span class=sb>`</span><span class=w> </span>STRING,
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>...
</span></code></pre></div> </details> <p>For a given table, the tool creates one folder with the table name, a Makefile to help manage the Flink statements with Confluent CLI, a <code>sql-scripts</code> folder for the Flink DDL and DML statements, and a <code>tests</code> folder to add <code>test_definitions.yaml</code> (using <code>shift_left table init-unit-tests</code>) for unit testing.</p> <p>Example of created folders:</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>facts
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span>└──<span class=w> </span>fct_examination_data
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>        </span>├──<span class=w> </span>Makefile
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>        </span>├──<span class=w> </span>sql-scripts
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>        </span>│<span class=w>   </span>├──<span class=w> </span>ddl.fct_examination_data.sql
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>        </span>│<span class=w>   </span>└──<span class=w> </span>dml.fct_examination_data.sql
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>        </span>└──<span class=w> </span>tests
</span></code></pre></div> <p>As part of the process, developers need to validate the generated DDL and update the PRIMARY key to reflect the expected key. This information is hidden in many files in dbt, and key extraction is not yet automated by the migration tools.</p> <p>Normally, the DML is not executable until all dependent input tables are created.</p> <h3 id=ksqldb-to-flink-sql>ksqlDB to Flink SQL<a class=headerlink href=#ksqldb-to-flink-sql title="Permanent link">&para;</a></h3> <p>ksqlDB has some SQL constructs, but this is not an ANSI SQL engine. It is highly integrated with Kafka and uses keywords to define such integration. The migration and prompts need to support migration examples outside of the classical SELECT and CREATE TABLE statements.</p> <ul> <li>Example command to migrate a ksqlDB script <div class="language-sh highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>shift_left<span class=w> </span>table<span class=w> </span>migrate<span class=w> </span>w2_processing<span class=w> </span><span class=nv>$SRC_FOLDER</span>/w2processing.ksql<span class=w> </span><span class=nv>$STAGING</span><span class=w> </span>--source-type<span class=w> </span>ksql<span class=w> </span>
</span></code></pre></div></li> </ul> <h2 id=current-agentic-approach>Current Agentic Approach<a class=headerlink href=#current-agentic-approach title="Permanent link">&para;</a></h2> <p>The current agentic workflow includes:</p> <ol> <li><strong>Translate</strong> the given SQL content</li> <li><strong>Validate</strong> the syntax and semantics</li> <li><strong>Generate</strong> DDL derived from DML</li> <li><strong>Get human validation</strong> to continue or not the automation</li> <li><strong>Deploy</strong> and test with validation agents [optional]</li> </ol> <p>The system uses validation agents that execute syntactic validation and automatic deployment, with feedback loops injecting error messages back to translator agents when validation fails.</p> <h2 id=architecture-overview>Architecture Overview<a class=headerlink href=#architecture-overview title="Permanent link">&para;</a></h2> <p>The multi-agent system with human-in-the-loop validation may use Confluent Cloud's Flink REST API to deploy a generated Flink statement. The following diagram represents the different agents working together:</p> <figure> <img alt="AI Agent Flow" src=../images/ai_agent_new_flow.drawio.png> </figure> <h3 id=agent-roles>Agent Roles<a class=headerlink href=#agent-roles title="Permanent link">&para;</a></h3> <p>As agent is a combination of LLM reference, prompts, and tool definitions, there will be different implementation of those agents if we do ksqlDB to Flink SQL or from Spark to Flink.</p> <h4 id=ksqldb-to-flink-agents>KsqlDB to Flink agents<a class=headerlink href=#ksqldb-to-flink-agents title="Permanent link">&para;</a></h4> <p>Supporting class of the workflow is <a href=https://github.com/jbcodeforce/shift_left_utils/blob/main/src/shift_left/src/shift_left/core/utils/ksql_code_agent.py>ksqlDB code agent</a>.</p> <table> <thead> <tr> <th>Agent</th> <th>Scope</th> <th>Prompt File</th> </tr> </thead> <tbody> <tr> <td><strong>Translator</strong></td> <td>Raw KSQL to Flink SQL translation</td> <td><code>core/utils/prompts/ksql_fsql/translator.txt</code></td> </tr> <tr> <td><strong>Table Detection</strong></td> <td>Identify multiple CREATE statements</td> <td><code>core/utils/prompts/ksql_fsql/table_detection.txt</code></td> </tr> <tr> <td><strong>Validation</strong></td> <td>Validate Flink SQL constructs</td> <td><code>core/utils/prompts/ksql_fsql/mandatory_validation.txt</code></td> </tr> <tr> <td><strong>Refinement</strong></td> <td>Fix deployment errors</td> <td><code>core/utils/prompts/ksql_fsql/refinement.txt</code></td> </tr> </tbody> </table> <h4 id=spark-to-flink-agents>Spark to Flink agents<a class=headerlink href=#spark-to-flink-agents title="Permanent link">&para;</a></h4> <p>Supporting class of the workflow is <a href=https://github.com/jbcodeforce/shift_left_utils/blob/main/src/shift_left/src/shift_left/core/utils/spark_sql_code_agent.py>Spark sql code agent</a> Same approach for spark SQL with the prompts being in the <code>core/utils/prompts/spark_fsql</code> folder.</p> <table> <thead> <tr> <th>Agent</th> <th>Scope</th> <th>Prompt File</th> </tr> </thead> <tbody> <tr> <td><strong>Translator</strong></td> <td>Spark SQL to Flink SQL translation</td> <td><code>core/utils/prompts/spark_fsql/translator.txt</code></td> </tr> <tr> <td><strong>Table Detection</strong></td> <td>Identify multiple CREATE statements</td> <td><code>core/utils/prompts/spark_fsql/table_detection.txt</code></td> </tr> <tr> <td><strong>Validation</strong></td> <td>Validate Flink SQL constructs</td> <td><code>core/utils/prompts/ksql_fsql/mandatory_validation.txt</code></td> </tr> <tr> <td><strong>Refinement</strong></td> <td>Fix deployment errors</td> <td><code>core/utils/prompts/ksql_fsql/refinement.txt</code></td> </tr> </tbody> </table> <h3 id=class-diagram>Class diagram<a class=headerlink href=#class-diagram title="Permanent link">&para;</a></h3> <p><img alt src=../images/ai_classes.drawio.png></p> <h2 id=a-test-bed>A test bed<a class=headerlink href=#a-test-bed title="Permanent link">&para;</a></h2> <p>The current project includes in the tests/data folder some examples of Spark and ksql scripts, but the following git project, <a href></a>, is a show case of Spark and Flink projects.</p> <h2 id=prerequisites-and-setup>Prerequisites and Setup<a class=headerlink href=#prerequisites-and-setup title="Permanent link">&para;</a></h2> <h3 id=environment-setup>Environment Setup<a class=headerlink href=#environment-setup title="Permanent link">&para;</a></h3> <ol> <li> <p>Clone the <a href=https://github.com/jbcodeforce/shift_left_utils>shift_left_utils git repository</a> <div class="language-sh highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/jbcodeforce/shift_left_utils
</span></code></pre></div></p> </li> <li> <p>Install <a href=https://github.com/astral-sh/uv>uv</a> for Python package management <div class="language-sh highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Install uv if not already installed</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>curl<span class=w> </span>-LsSf<span class=w> </span>https://astral.sh/uv/install.sh<span class=w> </span><span class=p>|</span><span class=w> </span>sh
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=c1># To update existing version</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>uv<span class=w> </span>self<span class=w> </span>update
</span></code></pre></div></p> </li> <li> <p><strong>Python Environment</strong>: Ensure Python 3.12+ and create a virtual environment <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>uv<span class=w> </span>venv<span class=w> </span>--python<span class=w> </span><span class=m>3</span>.12.0
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nb>source</span><span class=w> </span>.venv/bin/activate<span class=w>  </span><span class=c1># On Windows WSL: .venv\Scripts\activate</span>
</span></code></pre></div></p> </li> <li> <p><strong>Install Dependencies</strong>: Use <code>uv</code> package manager (recommended) <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nb>cd</span><span class=w> </span>src/shift_left
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=c1># Install project dependencies</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>uv<span class=w> </span>sync
</span></code></pre></div></p> </li> <li> <p><strong>Install shift_left Tool</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># under src/shift_left</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>ls<span class=w> </span>-al<span class=w> </span>dist/
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=c1># select the last version, for example:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>uv<span class=w> </span>tool<span class=w> </span>install<span class=w> </span>dist/shift_left-0.1.28-py3-none-any.whl
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=c1># Verify installation</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>shift_left<span class=w> </span>--help
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>shift_left<span class=w> </span>version
</span></code></pre></div></p> <p>You can also use <code>pip</code> if you have an existing Python environment: <div class="language-sh highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>pip<span class=w> </span>install<span class=w> </span>src/shift_left/dist/shift_left-0.1.28-py3-none-any.whl
</span></code></pre></div></p> </li> <li> <p>Make sure you are logged into Confluent Cloud and have defined at least one compute pool.</p> </li> </ol> <h3 id=configuration-file-setup>Configuration File Setup<a class=headerlink href=#configuration-file-setup title="Permanent link">&para;</a></h3> <ul> <li>Create a configuration file (e.g., <code>config-ccloud.yaml</code>): <div class="language-sh highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>cp<span class=w> </span>src/shift_left/src/shift_left/core/templates/config_tmpl.yaml<span class=w> </span>./config-ccloud.yaml
</span></code></pre></div></li> <li> <p>Update the content of the config-ccloud.yaml to reflect your Confluent Cloud environment. (For the commands used for migration, you do not need Kafka settings.) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Confluent Cloud Configuration</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nt>confluent_cloud</span><span class=p>:</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>  </span><span class=nt>api_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_API_KEY&quot;</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=nt>api_secret</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_API_SECRET&quot;</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=nt>organization_id</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_CLUSTER_ID&quot;</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>  </span><span class=nt>environment_id</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_ENVIRONMENT_ID&quot;</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=nt>url_scope</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">public</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_REGION&quot;</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=nt>flink</span><span class=p>:</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>  </span><span class=nt>flink_url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flink....confluent.cloud</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>  </span><span class=nt>compute_pool_id</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_COMPUTE_POOL_ID&quot;</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>  </span><span class=nt>api_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_API_KEY&quot;</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>  </span><span class=nt>api_secret</span><span class=p>:</span><span class=w> </span><span class=s>&quot;YOUR_API_SECRET&quot;</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>  </span><span class=nt>catalog_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;envionment_name&quot;</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>  </span><span class=nt>database_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;kafka_cluster_name&quot;</span>
</span></code></pre></div></p> </li> <li> <p>Set the following environment variables before using the tool. This can be done by: <div class="language-sh highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>cp<span class=w> </span>src/shift_left/src/shift_left/core/templates/set_env_temp<span class=w> </span>./set_env
</span></code></pre></div></p> <p>Modify the CONFIG_FILE, FLINK_PROJECT, SRC_FOLDER, SL_LLM_* variables</p> </li> <li> <p>Source it: <div class="language-sh highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nb>source</span><span class=w> </span>set_env
</span></code></pre></div></p> </li> <li> <p>Validate config-ccloud.yaml</p> </li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>shift_left<span class=w> </span>project<span class=w> </span>validate-config
</span></code></pre></div> <h2 id=migration-workflow>Migration Workflow<a class=headerlink href=#migration-workflow title="Permanent link">&para;</a></h2> <h3 id=1-project-initialization>1. Project Initialization<a class=headerlink href=#1-project-initialization title="Permanent link">&para;</a></h3> <p>Create a new target project to keep your Flink statements and pipelines (e.g., my-flink-app):</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Initialize project structure</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>shift_left<span class=w> </span>project<span class=w> </span>init<span class=w> </span>&lt;your-project&gt;<span class=w> </span>&lt;/path/to/your/folder&gt;
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=c1># example </span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>shift_left<span class=w> </span>project<span class=w> </span>init<span class=w> </span>my-flink-app<span class=w> </span><span class=nv>$HOME</span>/Code
</span></code></pre></div> <p>You should get: <div class="language-sh highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>my-flink-app
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>├──<span class=w> </span>README.md
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>├──<span class=w> </span>docs
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>├──<span class=w> </span>pipelines
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>│<span class=w>   </span>├──<span class=w> </span>common.mk
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>│<span class=w>   </span>├──<span class=w> </span>dimensions
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>│<span class=w>   </span>├──<span class=w> </span>facts
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>│<span class=w>   </span>├──<span class=w> </span>intermediates
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>│<span class=w>   </span>├──<span class=w> </span>sources
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>│<span class=w>   </span>└──<span class=w> </span>views
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>├──<span class=w> </span>sources
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>└──<span class=w> </span>staging
</span></code></pre></div></p> <h3 id=2-specific-setup>2. Specific Setup<a class=headerlink href=#2-specific-setup title="Permanent link">&para;</a></h3> <ul> <li>Copy your KSQL files to the sources directory:</li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Copy KSQL files</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>cp<span class=w> </span>*.ksql<span class=w> </span><span class=si>${</span><span class=nv>SRC_FOLDER</span><span class=si>}</span>/
</span></code></pre></div> <ul> <li> <p><em>Optional</em>: To run locally on a smaller model, download <a href=https://ollama.com/download>Ollama</a>, then install the qwen2.5-coder model: <div class="language-sh highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Select the size of the model according to your memory</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>ollama<span class=w> </span>pull<span class=w> </span>qwen2.5-coder:32b
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>ollama<span class=w> </span>list
</span></code></pre></div></p> </li> <li> <p>Create an OpenRouter.ai API key: <a href=https://openrouter.ai/ >https://openrouter.ai/</a>, to get access to larger models, like <code>qwen/qwen3-coder:free</code> which is free to use.</p> </li> <li> <p>Set environment variables:</p> </li> </ul> <h3 id=3-migration-execution>3. Migration Execution<a class=headerlink href=#3-migration-execution title="Permanent link">&para;</a></h3> <h4 id=basic-table-migration>Basic Table Migration<a class=headerlink href=#basic-table-migration title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Migrate a simple table</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>shift_left<span class=w> </span>table<span class=w> </span>migrate<span class=w> </span>basic_user_table<span class=w> </span><span class=nv>$SRC_FOLDER</span>/user-table.ksql<span class=w> </span><span class=nv>$STAGING</span><span class=w> </span>--source-type<span class=w> </span>ksql<span class=w> </span>
</span></code></pre></div> <p>The command generates: <div class="language-sh highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># ├── staging/basic_user_table/sql-scripts</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1># │   ├── ddl.basic_user_table.sql     # Flink DDL</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=c1># │   ├── dml.basic_user_table.sql     # Flink DML (if any)</span>
</span></code></pre></div></p> <h3 id=4-validation-and-deployment>4. Validation and Deployment<a class=headerlink href=#4-validation-and-deployment title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Deploy to Confluent Cloud for Flink</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>STAGING</span><span class=si>}</span>/basic_user_table
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># Deploy DDL statements</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>make<span class=w> </span>create_flink_ddl
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># Deploy DML statements  </span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>make<span class=w> </span>create_flink_dml
</span></code></pre></div> <h3 id=5-prepare-for-pipeline-management>5. Prepare for pipeline management<a class=headerlink href=#5-prepare-for-pipeline-management title="Permanent link">&para;</a></h3> <p>Flink statements have dependencies, so it is important to use shift_left to manage those dependencies:</p> <ul> <li> <p>Run after new tables are created <div class="language-sh highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>shift_left<span class=w> </span>table<span class=w> </span>build-inventory
</span></code></pre></div></p> </li> <li> <p>Build all the metadata <div class="language-sh highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>build-all-metadata<span class=w> </span>
</span></code></pre></div></p> </li> <li> <p>Verify an execution plan <div class="language-sh highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>build-execution-plan<span class=w> </span>--table-name<span class=w> </span>&lt;&gt;
</span></code></pre></div></p> </li> </ul> <h3 id=6-next>6. Next<a class=headerlink href=#6-next title="Permanent link">&para;</a></h3> <ul> <li> <p>Organize the Flink statements into pipeline folders, possibly using sources, intermediates, dimensions, and facts classification. Think about data products. A candidate hierarchy may look like this: <div class="language-sh highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>my-flink-app
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>├──<span class=w> </span>pipelines
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>│<span class=w>   </span>├──<span class=w> </span>common.mk
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>│<span class=w>   </span>├──<span class=w> </span>dimensions
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>│<span class=w>   </span>│<span class=w>   </span>├──<span class=w> </span>data_product_a
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>│<span class=w>   </span>├──<span class=w> </span>facts
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>│<span class=w>   </span>│<span class=w>   </span>├──<span class=w> </span>data_product_a
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>│<span class=w>   </span>├──<span class=w> </span>intermediates
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>│<span class=w>   </span>│<span class=w>   </span>├──<span class=w> </span>data_product_a
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>│<span class=w>   </span>├──<span class=w> </span>sources
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>│<span class=w>   </span>│<span class=w>   </span>├──<span class=w> </span>data_product_a
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>│<span class=w>   </span>│<span class=w>       </span>├──<span class=w> </span>src_stream
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>├──<span class=w> </span>Makefile
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>├──<span class=w> </span>pipeline_definition.json
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>├──<span class=w> </span>sql-scripts
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>│<span class=w>   </span>├──<span class=w> </span>ddl.src_stream.sql
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>│<span class=w>   </span>└──<span class=w> </span>dml.src_stream.sql
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a>│<span class=w>   </span>│<span class=w>       </span>│<span class=w>   </span>├──<span class=w> </span>tests
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>│<span class=w>   </span>├──<span class=w> </span>views
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>        </span>└──<span class=w> </span>data_product_a
</span></code></pre></div></p> </li> <li> <p>Add unit tests per table (at least for the complex DML ones) (<a href=../test_harness/ >see test harness</a>)</p> </li> <li>Add source data into the first tables of the pipeline</li> <li>Verify the created records within the sink tables.</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="Previous: Code structure"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Code structure </div> </div> </a> <a href=../../tracking/ class="md-footer__link md-footer__link--next" aria-label="Next: Feature Tracking"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Feature Tracking </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "search.suggest", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>