<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/shift_left_utils/pipeline_mgr/ rel=canonical><link href=../coding/test_harness/ rel=prev><link href=../blue_green_deploy/ rel=next><link rel=icon href=../assets/batchy.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Pipeline Management - Shift Left Utilities v0.1.48</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#pipeline-management class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Shift Left Utilities v0.1.48" class="md-header__button md-logo" aria-label="Shift Left Utilities v0.1.48" data-md-component=logo> <img src=../assets/batchy.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Shift Left Utilities v0.1.48 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Pipeline Management </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/shift_left_utils title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Shift Left Utilities v0.1.48" class="md-nav__button md-logo" aria-label="Shift Left Utilities v0.1.48" data-md-component=logo> <img src=../assets/batchy.png alt=logo> </a> Shift Left Utilities v0.1.48 </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/shift_left_utils title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../setup/ class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> <li class=md-nav__item> <a href=../recipes/ class=md-nav__link> <span class=md-ellipsis> Recipes </span> </a> </li> <li class=md-nav__item> <a href=../command/ class=md-nav__link> <span class=md-ellipsis> CLI References </span> </a> </li> <li class=md-nav__item> <a href=../coding/test_harness/ class=md-nav__link> <span class=md-ellipsis> Test Harness </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Pipeline Management </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Pipeline Management </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#context class=md-nav__link> <span class=md-ellipsis> Context </span> </a> <nav class=md-nav aria-label=Context> <ul class=md-nav__list> <li class=md-nav__item> <a href=#statement-evolution class=md-nav__link> <span class=md-ellipsis> Statement Evolution </span> </a> </li> <li class=md-nav__item> <a href=#flink-statement-interdependancies class=md-nav__link> <span class=md-ellipsis> Flink Statement interdependancies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-concepts-for-managing-flink-statement-pipelines class=md-nav__link> <span class=md-ellipsis> Core concepts for managing Flink Statement pipelines </span> </a> <nav class=md-nav aria-label="Core concepts for managing Flink Statement pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-cluster-support class=md-nav__link> <span class=md-ellipsis> Multi-cluster support </span> </a> </li> <li class=md-nav__item> <a href=#different-constraints-for-pipeline-deployment class=md-nav__link> <span class=md-ellipsis> Different constraints for pipeline deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tool-requirements class=md-nav__link> <span class=md-ellipsis> Tool Requirements </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../blue_green_deploy/ class=md-nav__link> <span class=md-ellipsis> Blue/Green Deployment </span> </a> </li> <li class=md-nav__item> <a href=../perf_test/ class=md-nav__link> <span class=md-ellipsis> Performance Testing </span> </a> </li> <li class=md-nav__item> <a href=../mcp/ class=md-nav__link> <span class=md-ellipsis> MCP server </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink-studies/coding/flink-sql/ class=md-nav__link> <span class=md-ellipsis> Flink SQL best practices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tutorial/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../tutorial/setup_lab/ class=md-nav__link> <span class=md-ellipsis> Setup Lab </span> </a> </li> <li class=md-nav__item> <a href=../tutorial/project/ class=md-nav__link> <span class=md-ellipsis> Project Management Lab </span> </a> </li> <li class=md-nav__item> <a href=../tutorial/migration_ai_lab/ class=md-nav__link> <span class=md-ellipsis> Migration AI Lab </span> </a> </li> <li class=md-nav__item> <a href=../tutorial/de_lab/ class=md-nav__link> <span class=md-ellipsis> Date Engineer day to day work - Lab </span> </a> </li> <li class=md-nav__item> <a href=../tutorial/sre_lab/ class=md-nav__link> <span class=md-ellipsis> SRE CI/CD process and other tasks - Lab </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> For Contributors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> For Contributors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../coding/ class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class=md-nav__item> <a href=../coding/llm_based_translation/ class=md-nav__link> <span class=md-ellipsis> AI based migration </span> </a> </li> <li class=md-nav__item> <a href=../tracking/ class=md-nav__link> <span class=md-ellipsis> Feature Tracking </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#context class=md-nav__link> <span class=md-ellipsis> Context </span> </a> <nav class=md-nav aria-label=Context> <ul class=md-nav__list> <li class=md-nav__item> <a href=#statement-evolution class=md-nav__link> <span class=md-ellipsis> Statement Evolution </span> </a> </li> <li class=md-nav__item> <a href=#flink-statement-interdependancies class=md-nav__link> <span class=md-ellipsis> Flink Statement interdependancies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-concepts-for-managing-flink-statement-pipelines class=md-nav__link> <span class=md-ellipsis> Core concepts for managing Flink Statement pipelines </span> </a> <nav class=md-nav aria-label="Core concepts for managing Flink Statement pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-cluster-support class=md-nav__link> <span class=md-ellipsis> Multi-cluster support </span> </a> </li> <li class=md-nav__item> <a href=#different-constraints-for-pipeline-deployment class=md-nav__link> <span class=md-ellipsis> Different constraints for pipeline deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tool-requirements class=md-nav__link> <span class=md-ellipsis> Tool Requirements </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=pipeline-management>Pipeline Management<a class=headerlink href=#pipeline-management title="Permanent link">&para;</a></h1> <details class="- info"> <summary>Version</summary> <p>Created Mars 21- 2025 - Update 5/28/25</p> </details> <p>The goals of this chapter is to present the requirements, design, and validation of the pipeline management tools.</p> <h2 id=context>Context<a class=headerlink href=#context title="Permanent link">&para;</a></h2> <h3 id=statement-evolution>Statement Evolution<a class=headerlink href=#statement-evolution title="Permanent link">&para;</a></h3> <p>Modifying streaming workloads over time, without serious side effects, is challenging: a workloadâ€™s downstream dependency chains run perpetually and expect continuous output. Any Flink DAG code is immutable, therefore a quick deployment strategy is to do not modify Flink process flow. When a SQL statement is started, it reads the source tables from the beginning (or any specified offset) and the operators, defined in the statement, build their state. Source or sink operators use the latest schema version for key and value at the time of deployment. </p> <p>The general strategy for <a href=https://docs.confluent.io/cloud/current/flink/concepts/schema-statement-evolution.html#query-evolution>query evolution</a> is to replace the existing statement and the corresponding tables it maintains with a new statement and new tables. Let take a simple example of a Flink statement joining two tables and with an output table also used by a join within a second statement:</p> <figure> <img alt=1 src=../images/stateful_evolution.drawio.png> <figcaption>Stateful Flink statement evolution</figcaption> </figure> <p>The streaming processing has processed all blue records and a new version needs to be applied at a time from which new records processed may have an impact.</p> <p>The typical change to consider are:</p> <ul> <li>adding a new column in a select statement</li> <li>removing a field in a select statement</li> <li>adding aggregation dimension or new joins, with full historical records reprocessing,</li> </ul> <p>For each Flink Statement deployment some questions need to be assessed:</p> <ul> <li>What should be done with the pre-existing output records? </li> <li>Does the update impact the meaning ot the output? (change the dimensionality of an aggregation)</li> <li>What happens if the new output format breaks compatibility with the old? </li> <li>How can the old and new data structures be made to work together, and what if they can't?</li> </ul> <p>Which can be summarized, which statement need to backfill for the earliest or not. </p> <p>As illustrated in the [query evolution - basic strategy section], the process is to stop Flink statements to change, create a new table _v2, and once lag is recovered, swap consumers from the old topic to the new one.</p> <p><img alt src=../images/stateful_evolution_swap.drawio.png></p> <h3 id=flink-statement-interdependancies>Flink Statement interdependancies<a class=headerlink href=#flink-statement-interdependancies title="Permanent link">&para;</a></h3> <p>Flink statements are inherently interdependent, consuming and joining tables produced by other statements, forming a complex pipeline. Careful deployment is crucial. The following diagram illustrates this interconnectedness for a simple example and outlines a pipeline management strategy.</p> <figure> <img alt src=../images/flink_pipeline.png> <figcaption>a pipeline of Flink statements</figcaption> </figure> <p><em>This graph is generated by running a report like: <code>shift_left pipeline report fct_order --graph</code></em></p> <details class="- info"> <summary>Test data</summary> <p>The folder <a href=https://github.com/jbcodeforce/shift_left_utils/tree/cli/src/shift_left/tests/data>src/shift_left/tests/data</a> includes a Flink-project with the DDLs and DMLs to support the graph illustrated above, and it is used in all the test cases.</p> </details> <h2 id=core-concepts-for-managing-flink-statement-pipelines>Core concepts for managing Flink Statement pipelines<a class=headerlink href=#core-concepts-for-managing-flink-statement-pipelines title="Permanent link">&para;</a></h2> <p>The <a href=../recipes/ >recipe chapter</a> has how-to descriptions for the specific commands to use during development and during the pipeline management by system reliability engineers. The following high level concepts are the foundations for this management:</p> <ol> <li>The git folder is the source of truth for pipeline definitions. </li> <li> <p>The table inventory, which lists all the Flink tables of a project, is used as the foundation to find basic metadata about Flink statements. It must be created with a simple command like:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>shift_left table build-inventory $PIPELINES
</span></code></pre></div> <p>The <code>inventory.json</code> is persisted in the $PIPELINES folder and committed in git. It will be extensively used by any pipeline commands. It could be updated at each PR by a CI tool.</p> </li> <li> <p>For each table <code>pipeline_definition json</code> file, includes a single level of information about the pipeline. Those files are built from the sink tables going up to the sources. During the Flink development phase, developers may use this tool to build the metadata:</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>build_metadata<span class=w> </span><span class=nv>$PIPELINES</span>/facts/p1/fct_order/sql_scripts/dml.fct_order.sql<span class=w> </span><span class=nv>$PIPELINES</span>
</span></code></pre></div> <p>The created file may look like:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=p>{</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=nt>&quot;table_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fact&quot;</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>    </span><span class=nt>&quot;dml_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/dml.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>    </span><span class=nt>&quot;ddl_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/ddl.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>    </span><span class=nt>&quot;state_form&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Stateful&quot;</span><span class=p>,</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>    </span><span class=nt>&quot;parents&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>            </span><span class=nt>&quot;table_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;int_table_2&quot;</span><span class=p>,</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>            </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;intermediate&quot;</span><span class=p>,</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>            </span><span class=nt>&quot;dml_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_2/sql-scripts/dml.int_table_2.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>            </span><span class=nt>&quot;ddl_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_2/sql-scripts/ddl.int_table_2.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>            </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_2&quot;</span><span class=p>,</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>            </span><span class=nt>&quot;state_form&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Stateful&quot;</span><span class=p>,</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>            </span><span class=nt>&quot;parents&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>            </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>                </span><span class=p>{</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>                </span><span class=nt>&quot;table_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=w>                </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fact&quot;</span><span class=p>,</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=w>                </span><span class=nt>&quot;dml_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/dml.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=w>                </span><span class=nt>&quot;ddl_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/ddl.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=w>                </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=w>                </span><span class=nt>&quot;state_form&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Stateful&quot;</span><span class=p>,</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=w>                </span><span class=nt>&quot;parents&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=w>                </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=w>            </span><span class=p>]</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a><span class=w>            </span><span class=nt>&quot;table_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;int_table_1&quot;</span><span class=p>,</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=w>            </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;intermediate&quot;</span><span class=p>,</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=w>            </span><span class=nt>&quot;dml_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_1/sql-scripts/dml.int_table_1.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=w>            </span><span class=nt>&quot;ddl_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_1/sql-scripts/ddl.int_table_1.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=w>            </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/intermediates/p1/int_table_1&quot;</span><span class=p>,</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=w>            </span><span class=nt>&quot;state_form&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Stateful&quot;</span><span class=p>,</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=w>            </span><span class=nt>&quot;parents&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=w>            </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=w>                </span><span class=p>{</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=w>                </span><span class=nt>&quot;table_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=w>                </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;fact&quot;</span><span class=p>,</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=w>                </span><span class=nt>&quot;dml_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/dml.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=w>                </span><span class=nt>&quot;ddl_ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order/sql-scripts/ddl.fct_order.sql&quot;</span><span class=p>,</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=w>                </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pipelines/facts/p1/fct_order&quot;</span><span class=p>,</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a><span class=w>                </span><span class=nt>&quot;state_form&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Stateful&quot;</span><span class=p>,</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a><span class=w>                </span><span class=nt>&quot;parents&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a><span class=w>                </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a><span class=w>            </span><span class=p>]</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a><span class=w>    </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=p>}</span>
</span></code></pre></div> <p>Developers or SREs may use others command to go over all facts, dimensions or views folders, to create all the <code>pipeline_definition.json</code> from each of the dml of those tables:</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>build-all-metadata<span class=w> </span><span class=nv>$PIPELINES</span>/facts
</span></code></pre></div> <p>Note that going while walking up a second pipeline from a new sink, may modify the pipeline_definitions.json of an existing parent table, to update the list of children with the new sink. Same for new intermediate table. The parents and children lists are in fact Sets so there is no duplicate entry if a table is used by multiple pipelines.</p> </li> <li> <p>A hierarchy view of a pipeline can be used for reporting, or by the developer to understand the complex tree:</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>report<span class=w> </span>fct_order<span class=w> </span>--json
</span></code></pre></div> <p>The optins are <code>--json</code>, <code>--simple</code>, <code>--yaml</code> or <code>--graph</code> can be used. </p> </li> <li> <p>Hierarchy view is used to deploy a selected table, its parents and eventually its children. </p> </li> <li> <p>For deployment they are some heuristic to follow:</p> <ol> <li>when deploying a Flink statement, for any parent (tables used for select or joins) currently not running, the tools needs to start them</li> <li>When the current intermediate table, one with children and parents, is generating events from a stateful processing, the output table needs to be recreated, the consumers who consumed from the earliest needs to be restarted. Eventually this means cascading down the children graph to restart all the impacted children.</li> <li>For a current intermediate table, if a child is stateful, then the tool needs to restart this child once the current topic / table is created. If the child is stateless then offset management needs to be done: the children is stopped, and restarted from last committed offset. </li> <li>The deployment follows a sources to sink deployment to ensure that for a given table all parents are running.</li> </ol> </li> </ol> <h3 id=multi-cluster-support>Multi-cluster support<a class=headerlink href=#multi-cluster-support title="Permanent link">&para;</a></h3> <p>Flink is deployed at the environment level. An environment may have multiple Kafka clusters. A schema registry is also at the environment level. The tool needs to support conflicting consistency: do not overwrite schema, separate cluster or topics within the same cluster. The following figure illustrates those concepts:</p> <p><img alt src=../images/multiple-cluster.drawio.png></p> <p>Therefore the following are important requirements to address:</p> <ul> <li>Tables are created by flink job and may avoid conflicting so a naming convention is needed, sepcially when a unique cluster is used for dev and staging: dev-<table-name>; <stage-tablename> </li> <li>Flink job (dml-*) needs to follow a naming convention to easily find compute pool to statement allocation in the Console.</li> <li>Sources topics may have been created by external systems so it may also being created with naming convention, or the same source topics used by the different deployment.</li> <li>Schemas in the registry needs to support context and each created table definition uses the <code>key.avro-registry.schema-context</code> = '.flink-stage' or '.flink-dev' settings.</li> <li>Table name needs to follow a naming convention to separate dev and stage.</li> <li>When stage is a separate kafka cluster then the catalog and database names are used to define the scope of the created tables.</li> </ul> <style>
table th:first-of-type {
    width: 50%;
}
table th:nth-of-type(1) {
    width: 50%;
}
</style> <table> <thead> <tr> <th>table name</th> <th>schema context</th> </tr> </thead> <tbody> <tr> <td>src_p1_table_1</td> <td>.flink-dev</td> </tr> <tr> <td>src_p1_table_2</td> <td>.flink-dev</td> </tr> <tr> <td>src_p1_table_3</td> <td>.flink-dev</td> </tr> <tr> <td>p1_fct_table_1</td> <td>.flink-dev</td> </tr> <tr> <td>src_p1_table_1</td> <td>.flink-stage</td> </tr> <tr> <td>src_p1_table_2</td> <td>.flink-stage</td> </tr> <tr> <td>src_p1_table_3</td> <td>.flink-stage</td> </tr> <tr> <td>p1_fct_table_1</td> <td>.flink-stage</td> </tr> </tbody> </table> <p>The shift_left <code>config..yaml</code> file needs to be specific per deployment target. The table illustrates the parameters specific for a given environment</p> <style>
table th:first-of-type {
    width: 40%;
}
table th:nth-of-type(2) {
    width: 30%;
}
</style> <table> <thead> <tr> <th>Use case</th> <th>Goal</th> <th>Parameter to set</th> </tr> </thead> <tbody> <tr> <td>Deploy to dev env and cluster</td> <td>Tables are create with prefix</td> <td><code>kafka.cluster_type: dev</code> and <code>flink.catalog_name: dev-env</code> <code>flink.database_name: dev-cluster</code></td> </tr> <tr> <td>Deploy to stage same kafka cluster, same env</td> <td>Tables are create with prefix to separate from dev</td> <td><code>kafka.cluster_type: stage</code> and <code>flink.catalog_name: dev-env</code> <code>flink.database_name: dev-cluster</code></td> </tr> <tr> <td>Deploy to stage different kafka cluster same environment</td> <td>Tables are create with prefix but the database name is different too.</td> <td><code>kafka.cluster_type: stage</code> and <code>flink.catalog_name: dev-env</code> <code>flink.database_name: stage-cluster</code></td> </tr> </tbody> </table> <h3 id=different-constraints-for-pipeline-deployment>Different constraints for pipeline deployment<a class=headerlink href=#different-constraints-for-pipeline-deployment title="Permanent link">&para;</a></h3> <h4 id=deploying-a-fact-table>Deploying a fact table<a class=headerlink href=#deploying-a-fact-table title="Permanent link">&para;</a></h4> <p>During development, Flink SQL developers use the makefile: see <a href=../recipes/#data-engineer-centric-use-cases>this recipe</a> to deploy statement. While preparing for staging or integration tests, it may be relevant to deploy a full pipeline from a sink table. For example SREs want to deploy the sink <code>fct_order</code> table. To make the DML running successfuly, as it joins two tables, both tables need to be created. So the tool needs to walk up the hierarchy to deploy parents, up to the source. The white colored topic and Flink statements are currently running, tables and topics have messages. Before deploying the <code>fct_order dml</code>, the tool needs to assess what are the current parents table running. If there are missing tables, the tool needs to deploy those, taking into consideration parents of parents. For example, for the <code>int_table_1</code> which is not created, the tool needs first to run the DDL <code>src_table_1</code> and any <code>DML for src_table_1</code>. (in the test the dml of the sources are just inserting records, but in real project, those DMLs may consume from an existing Kafka topic created via CDC), thne run the <code>int_table_1</code> DDL and DML, to finally deploy the <code>fct_order</code> DDL and DML. </p> <figure> <img alt src=../images/flink_pipeline_1.drawio.png> <figcaption>Sink table deployment - with parent deployment</figcaption> </figure> <p>The red color highlights what is the goal of the deployment. The white represents what is stable, while the orange elements are impacted by the deployment. </p> <details class="- info"> <summary>Step to demonstrate a sink table deployment</summary> <ul> <li>Remove any older logs with <code>rm ~/.shift_left/logs/*.log*</code></li> <li>Be sure <code>config.yaml</code> has the good parameters in particular the flink and Confluent cloud access API keys, secrets, a default compute_pool_id and the appropriate logging level.</li> <li>Defines the PIPELINES and CONFIG_FILE environment variables</li> <li>Ensure the table inventory is up to date, if not run <code>shift_left table build-inventory $PIPELINES</code></li> <li>If for any reason, the pipeline definitions for the given pipeline needs to be recreated, run: <code>shift_left pipeline build-metadata fct_order $PIPELINES</code></li> <li>Deploy the fact table: <code>shift_left pipeline deploy --table-name fct_order</code></li> <li>Verify in the Confluent Cloud console the Flink statements running and the topics created, or run the command: <code>shift_left pipeline report-running-statements --table-name fct_order</code>.</li> </ul> </details> <h4 id=deploying-an-intermediate-table>Deploying an intermediate table<a class=headerlink href=#deploying-an-intermediate-table title="Permanent link">&para;</a></h4> <p>Intermediate table deployment, will follow the same principle as above if parent in the upward hierarchy are not running, but most important, it may impact children. The behavior of the deployment will be different if the DML are stateful, for the current DML to deploy but also for the children. The red color means those elements will be recreated, and orange means they may be impacted for a re-deployment. For stateful with earliest-offset consumption, will mean the topic needs to be recreated and the downstream children recreated. For stateless, stopping, getting the offset and restarting from the saved offset will work.</p> <figure> <img alt src=../images/flink_pipeline_2.drawio.png> <figcaption>Intermediate table deployment</figcaption> </figure> <h4 id=deploying-source-table>Deploying source table<a class=headerlink href=#deploying-source-table title="Permanent link">&para;</a></h4> <p>For source processing, it may impact more children elements. Most of those processing are doing deduplication or transforming to upsert table with different primary keys, which means becoming stateful.</p> <figure> <img alt src=../images/flink_pipeline_3.drawio.png> <figcaption>Source table deployment</figcaption> </figure> <h4 id=more-complex-graph-for-testing>More complex graph for testing<a class=headerlink href=#more-complex-graph-for-testing title="Permanent link">&para;</a></h4> <p>The following graph represents a more complex network of dependencies to illustrate the following patterns:</p> <ul> <li>intermediate table Z has multiple parents with their own sources. So deploy Z will mean assessing X, and Y trees</li> <li>Running every node may impact restarting any children</li> </ul> <figure> <img alt src=../images/flink_pipeline_for_test.drawio.png> <figcaption>Topology used for test</figcaption> </figure> <p><em>topics are not represented between Flink Statements, only the four source topics.</em></p> <p>The navigation to the parents needs to follow a depth first search to get all non running parents, while restarting children should follow a breath first search.</p> <p>The approach is also to build an execution plan and then execute the plan in the order of the definition.</p> <h2 id=tool-requirements>Tool Requirements<a class=headerlink href=#tool-requirements title="Permanent link">&para;</a></h2> <p>The following list presents the requirements to implement for the shift_left deploy command:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> The expected command to deploy should be as simple as:</li> </ul> <div class="language-sh highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>shift_left<span class=w> </span>pipeline<span class=w> </span>deploy<span class=w> </span><span class=o>[</span>OPTIONS<span class=o>]</span><span class=w> </span>INVENTORY_PATH
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>**Options**:
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--table-name<span class=w> </span>TEXT<span class=sb>`</span>:<span class=w> </span>The<span class=w> </span>table<span class=w> </span>name<span class=w> </span>containing<span class=w> </span>pipeline_definition.json.
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--compute-pool-id<span class=w> </span>TEXT<span class=sb>`</span>:<span class=w> </span>Flink<span class=w> </span>compute<span class=w> </span>pool<span class=w> </span>ID.<span class=w> </span>If<span class=w> </span>not<span class=w> </span>provided,<span class=w> </span>it<span class=w> </span>will<span class=w> </span>create<span class=w> </span>a<span class=w> </span>pool.
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--dml-only<span class=w> </span>/<span class=w> </span>--no-dml-only<span class=sb>`</span>:<span class=w> </span>By<span class=w> </span>default<span class=w> </span>the<span class=w> </span>deployment<span class=w> </span>will<span class=w> </span><span class=k>do</span><span class=w> </span>DDL<span class=w> </span>and<span class=w> </span>DML,<span class=w> </span>with<span class=w> </span>this<span class=w> </span>flag<span class=w> </span>it<span class=w> </span>will<span class=w> </span>deploy<span class=w> </span>only<span class=w> </span>DML<span class=w>  </span><span class=o>[</span>default:<span class=w> </span>no-dml-only<span class=o>]</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--may-start-children<span class=w> </span>/<span class=w> </span>--no-may-start-children<span class=sb>`</span>:<span class=w> </span>The<span class=w> </span>children<span class=w> </span>deletion<span class=w> </span>will<span class=w> </span>be<span class=w> </span><span class=k>done</span><span class=w> </span>only<span class=w> </span><span class=k>if</span><span class=w> </span>they<span class=w> </span>are<span class=w> </span>stateful.<span class=w> </span>This<span class=w> </span>Flag<span class=w> </span>force<span class=w> </span>to<span class=w> </span>drop<span class=w> </span>table<span class=w> </span>and<span class=w> </span>recreate<span class=w> </span>all<span class=w> </span><span class=o>(</span>ddl,<span class=w> </span>dml<span class=o>)</span><span class=w>  </span><span class=o>[</span>default:<span class=w> </span>no-may-start-children<span class=o>]</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--force-sources<span class=w> </span>/<span class=w> </span>--no-force-sources<span class=sb>`</span>:<span class=w> </span>When<span class=w> </span>reaching<span class=w> </span>table<span class=w> </span>with<span class=w> </span>no<span class=w> </span>ancestor,<span class=w> </span>this<span class=w> </span>flag<span class=w> </span>forces<span class=w> </span>restarting<span class=w> </span>running<span class=w> </span>Flink<span class=w> </span>statements.<span class=w>  </span><span class=o>[</span>default:<span class=w> </span>no-force-sources<span class=o>]</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span>*<span class=w> </span><span class=sb>`</span>--dir<span class=w> </span>TEXT<span class=sb>`</span>:<span class=w> </span>The<span class=w> </span>directory<span class=w> </span>to<span class=w> </span>deploy<span class=w> </span>the<span class=w> </span>pipeline<span class=w> </span>from.<span class=w> </span>If<span class=w> </span>not<span class=w> </span>provided,<span class=w> </span>it<span class=w> </span>will<span class=w> </span>deploy<span class=w> </span>the<span class=w> </span>pipeline<span class=w> </span>from<span class=w> </span>the<span class=w> </span>table<span class=w> </span>name.<span class=w> </span>
</span></code></pre></div> <ul class=task-list> <li class=task-list-item> <p><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Deploy dml - ddl: Given the table name, executes the dml and ddl to deploy a pipeline. If the compute pool id is present it will use it. If not, it will get the existing pool_id from the table already deployed, if none is defined it will create a new pool and assign the pool_id. A deployment may impact children statement depending of the semantic of the current DDL and the children's one.</p> </li> <li class=task-list-item> <p><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Support deploying only DML, or both DDL and DML (default)</p> </li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Deploying a DDL, means dropping existing table if exists.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Deploying a non existing sink means deploying all its parents if not already deployed, up to the sources. This will be the way to deploy a pipeline. In this case deploy first the sources, ddl and dml, except if already running as it means the current table was created by another pipeline. This is recursive.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> For a given table with children, deploy the current table, and for each children redeploy the DML, if the DML is stateful. When stateless, manage the offset and modify the DML to read from the retrieved offset.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Support deleting a full pipeline: delete tables not used by other pipeline: the number of children is 1 or all the children are not running.</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../coding/test_harness/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Test Harness"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Test Harness </div> </div> </a> <a href=../blue_green_deploy/ class="md-footer__link md-footer__link--next" aria-label="Next: Blue/Green Deployment"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Blue/Green Deployment </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024-2026 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "search.suggest", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>