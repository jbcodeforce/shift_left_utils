<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><link href="https://jeromeboyer.net/shift_left_utils/tutorial/project/" rel="canonical"/><link href="../setup_lab/" rel="prev"/><link href="../migration_ai_lab/" rel="next"/><link href="../../assets/batchy.png" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/><title>Project Management Lab - Shift Left Utilities v0.1.48</title><link href="../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../extra.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#lab-project-management"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="Shift Left Utilities v0.1.48" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Shift Left Utilities v0.1.48"> <img alt="logo" src="../../assets/batchy.png"/> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Shift Left Utilities v0.1.48 </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Project Management Lab </span> </div> </div> </div> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/jbcodeforce/shift_left_utils" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="Shift Left Utilities v0.1.48" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Shift Left Utilities v0.1.48"> <img alt="logo" src="../../assets/batchy.png"/> </a> Shift Left Utilities v0.1.48 </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/jbcodeforce/shift_left_utils" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../.."> <span class="md-ellipsis"> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex=""> <span class="md-ellipsis"> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../setup/"> <span class="md-ellipsis"> Environment Setup </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../recipes/"> <span class="md-ellipsis"> Recipes </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../command/"> <span class="md-ellipsis"> CLI References </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../coding/test_harness/"> <span class="md-ellipsis"> Test Harness </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../pipeline_mgr/"> <span class="md-ellipsis"> Pipeline Management </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../blue_green_deploy/"> <span class="md-ellipsis"> Blue/Green Deployment </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../perf_test/"> <span class="md-ellipsis"> Performance Testing </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mcp/"> <span class="md-ellipsis"> MCP server </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="https://jbcodeforce.github.io/flink-studies/coding/flink-sql/"> <span class="md-ellipsis"> Flink SQL best practices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/> <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex=""> <span class="md-ellipsis"> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Introduction </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../setup_lab/"> <span class="md-ellipsis"> Setup Lab </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Project Management Lab </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> Project Management Lab </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisite"> <span class="md-ellipsis"> Prerequisite </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#initialize-a-project"> <span class="md-ellipsis"> Initialize a Project </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#leveraging-infrastructure-as-code"> <span class="md-ellipsis"> Leveraging Infrastructure As Code </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#add-a-source-table"> <span class="md-ellipsis"> Add a source table </span> </a> <nav aria-label="Add a source table" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#update-the-ddl-content"> <span class="md-ellipsis"> Update the DDL content </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#update-the-dml-content"> <span class="md-ellipsis"> Update the DML content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#adding-unit-tests"> <span class="md-ellipsis"> Adding unit tests </span> </a> <nav aria-label="Adding unit tests" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#run-unit-tests"> <span class="md-ellipsis"> Run unit tests </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#project-admin-work"> <span class="md-ellipsis"> Project Admin Work </span> </a> <nav aria-label="Project Admin Work" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#build-table-inventory"> <span class="md-ellipsis"> Build table inventory </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#validate-config"> <span class="md-ellipsis"> Validate config </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#build-table-relationships"> <span class="md-ellipsis"> Build Table RelationShips </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#get-table-use-cross-data-product"> <span class="md-ellipsis"> Get Table Use Cross Data Product </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#list-tables-with-one-child"> <span class="md-ellipsis"> List tables with one child </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#getting-the-list-of-compute-pools"> <span class="md-ellipsis"> Getting the list of compute pools </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#getting-the-list-of-statements-running-in-a-compute-pool"> <span class="md-ellipsis"> Getting the list of statements running in a compute pool </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#housekeep-statements"> <span class="md-ellipsis"> Housekeep statements </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#list-modified-files"> <span class="md-ellipsis"> List modified files </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#orphan-and-unused-tables"> <span class="md-ellipsis"> Orphan and unused tables </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#drop-all-tables-from-a-list"> <span class="md-ellipsis"> Drop all tables from a list </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../migration_ai_lab/"> <span class="md-ellipsis"> Migration AI Lab </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../de_lab/"> <span class="md-ellipsis"> Date Engineer day to day work - Lab </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../sre_lab/"> <span class="md-ellipsis"> SRE CI/CD process and other tasks - Lab </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex=""> <span class="md-ellipsis"> For Contributors </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> For Contributors </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../contributing/"> <span class="md-ellipsis"> Contributing </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../coding/"> <span class="md-ellipsis"> Code structure </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../coding/llm_based_translation/"> <span class="md-ellipsis"> AI based migration </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../tracking/"> <span class="md-ellipsis"> Feature Tracking </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisite"> <span class="md-ellipsis"> Prerequisite </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#initialize-a-project"> <span class="md-ellipsis"> Initialize a Project </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#leveraging-infrastructure-as-code"> <span class="md-ellipsis"> Leveraging Infrastructure As Code </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#add-a-source-table"> <span class="md-ellipsis"> Add a source table </span> </a> <nav aria-label="Add a source table" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#update-the-ddl-content"> <span class="md-ellipsis"> Update the DDL content </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#update-the-dml-content"> <span class="md-ellipsis"> Update the DML content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#adding-unit-tests"> <span class="md-ellipsis"> Adding unit tests </span> </a> <nav aria-label="Adding unit tests" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#run-unit-tests"> <span class="md-ellipsis"> Run unit tests </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#project-admin-work"> <span class="md-ellipsis"> Project Admin Work </span> </a> <nav aria-label="Project Admin Work" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#build-table-inventory"> <span class="md-ellipsis"> Build table inventory </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#validate-config"> <span class="md-ellipsis"> Validate config </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#build-table-relationships"> <span class="md-ellipsis"> Build Table RelationShips </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#get-table-use-cross-data-product"> <span class="md-ellipsis"> Get Table Use Cross Data Product </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#list-tables-with-one-child"> <span class="md-ellipsis"> List tables with one child </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#getting-the-list-of-compute-pools"> <span class="md-ellipsis"> Getting the list of compute pools </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#getting-the-list-of-statements-running-in-a-compute-pool"> <span class="md-ellipsis"> Getting the list of statements running in a compute pool </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#housekeep-statements"> <span class="md-ellipsis"> Housekeep statements </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#list-modified-files"> <span class="md-ellipsis"> List modified files </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#orphan-and-unused-tables"> <span class="md-ellipsis"> Orphan and unused tables </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#drop-all-tables-from-a-list"> <span class="md-ellipsis"> Drop all tables from a list </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="lab-project-management">Lab: Project Management<a class="headerlink" href="#lab-project-management" title="Permanent link">¶</a></h1> <p>This lab focuses on starting a Confluent Flink project at scale, using best practices gathered during different real-life projects.</p> <p>At the highest level, the SDLC for flink project, may include the following activities:</p> <figure> <img alt="" src="../images/flink_dev_flow.drawio.png"/> </figure> <p>This labs introduces such activities.</p> <h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">¶</a></h2> <p>You have followed <a href="../setup_lab/">the setup lab</a> to get shift_left CLI configured and running. Ensure <code>CONFIG_FILE</code>, <code>PIPELINES</code>, are set as described.</p> <p>In this lab, we are addressing the folling </p> <ul> <li><a href="#initialize-a-project">Initialize a Project</a> using infrastructure as code and CLI.</li> <li><a href="#add-a-source-table">Add tables</a> to add source processing, or building dimensions and facts using a data product approach.</li> <li><a href="#adding-unit-tests">Adding unit tests</a> to run on Confluent Cloud.</li> <li><a href="#project-admin-work">Project Admin Work</a> like building a table inventory, managing table metadata,working on Flink statements, assess table or data product execution plans, find orphan tables. </li> </ul> <h2 id="initialize-a-project">Initialize a Project<a class="headerlink" href="#initialize-a-project" title="Permanent link">¶</a></h2> <ul> <li>Select a folder from where to create the Flink project</li> <li>Execute the project init command: <div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>init<span class="w"> </span>&lt;project_name&gt;<span class="w"> </span>&lt;project_path&gt;
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="c1"># Example for a default Kimball project</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>shift_left<span class="w"> </span>project<span class="w"> </span>init<span class="w"> </span>dsp<span class="w"> </span>.
</span></code></pre></div></li> </ul> <p>The created folder structure looks like: <div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>dsp
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>├──<span class="w"> </span>docs
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>├──<span class="w"> </span>IaC
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>│<span class="w">   </span>└──<span class="w"> </span>environments
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>│<span class="w">       </span>├──<span class="w"> </span>dev
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>confluent_tf_graph.md
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>confluent.tf
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>outputs.tf
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>providers.tf
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>terraform.tfvars.example
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>variables.tf
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>│<span class="w">       </span>└──<span class="w"> </span>prod
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>├──<span class="w"> </span>pipelines
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>│<span class="w">   </span>├──<span class="w"> </span>common.mk
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>│<span class="w">   </span>├──<span class="w"> </span>dimensions
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>│<span class="w">   </span>├──<span class="w"> </span>facts
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>│<span class="w">   </span>├──<span class="w"> </span>intermediates
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>│<span class="w">   </span>├──<span class="w"> </span>sources
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>│<span class="w">   </span>└──<span class="w"> </span>views
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a>└──<span class="w"> </span>staging
</span></code></pre></div></p> <h2 id="leveraging-infrastructure-as-code">Leveraging Infrastructure As Code<a class="headerlink" href="#leveraging-infrastructure-as-code" title="Permanent link">¶</a></h2> <p>The approach is to use Terraform to create Confluent Cloud Environment, Kafka Cluster, Schema Registry and Compute pool. The created files are under the IaC folder and include:</p> <table> <thead> <tr> <th>File</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>providers.tf</td> <td>Terraform provider configuration (Confluent, etc.)</td> </tr> <tr> <td>confluent.tf</td> <td>Confluent Cloud resources (environment, Kafka, Schema Registry, compute pool)</td> </tr> <tr> <td>variables.tf</td> <td>Input variables (e.g. region, cluster name)</td> </tr> <tr> <td>outputs.tf</td> <td>Output values (resource IDs, API keys)</td> </tr> </tbody> </table> <p>To be able to run the terraform, a SRE needs to create, in the Confluent Console, a service account, and the confluent cloud key and secrets for the terraform cli to use.</p> <p>It is possible to reuse existing environment, schema registry and kafka cluster by setting their ids in the <code>terraform.tfvars</code> file.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nv">existing_environment_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"env-xxxxx"</span><span class="w">  </span><span class="c1"># Leave null to create new environment</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nv">existing_kafka_cluster_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"lkc-xxxxx"</span><span class="w">  </span><span class="c1"># Leave null to create new cluster</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nv">existing_schema_registry_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"lsrc-xxxxx"</span><span class="w">  </span><span class="c1"># Leave null to use auto-provisioned Schema Registry</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="nv">existing_service_account_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"sa-xxxxx"</span><span class="w">   </span><span class="c1"># Leave null to create new service account</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nv">existing_flink_compute_pool_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"lfcp-xxxxx"</span><span class="w">  </span><span class="c1"># Uncomment and set ID to reuse existing</span>
</span></code></pre></div> <p>The elements created are:</p> <pre class="mermaid"><code>    flowchart TB
    subgraph env [Environment]
        cc_env[cc_env resource]
        subgraph kafka [Kafka Custer]
        kafka_cluster[kafka_cluster resource]
        ssa_kafka_key[sa_kafka_key API Key]
        end
        subgraph dsp_sr[Schema Registry]
        sr[schema_registry resource]
        sa_sr_key[sa_schema_registry_key API Key]
        end
        subgraph flink [Flink Compute Pool]
            flink_cp[flink_compute_pool resource]
            sa_flink_key[sa_flink_key API Key]
        end
    end

    subgraph sa [Service Accounts]
        sa_res[service_account resource]
        sa_env_admin[sa_env_admin RoleBinding]
    end

    sa_res --&gt;|"EnvironmentAdmin"| env</code></pre> <p>In most environment, it will be possible to get the production data to the dev Kafka Cluster. Below is a typical architecture for development using <a href="https://docs.confluent.io/cloud/current/clusters/index.html">cluster link</a> and <a href="https://docs.confluent.io/cloud/current/sr/schema-linking.html">schema linking</a>.</p> <figure> <img alt="" src="../images/data_replic_env.drawio.png"/> </figure> <p>This means testing Flink statements on real-life data, is very valuable to verify if the statement works, but also assess data quality and data skew.</p> <h2 id="add-a-source-table">Add a source table<a class="headerlink" href="#add-a-source-table" title="Permanent link">¶</a></h2> <p>The goal for source tables, is to remove duplication, filter records, and maybe do transformation from the raw topic. If the raw topic is coming from a CDC, the record structure matches the table structure in the SQL database (CDC software like Debezium also includes envelop like <code>before</code> and <code>after</code> fields). Some column may be VARCHAR with a json object inside. It may be relevant to extract those information as new column in a Flink table. Each source table is published to its own raw topic, so there will be one Flink statement per raw topic:</p> <figure> <img alt="" src="../images/raw_to_src.drawio.png"/> </figure> <p>As an example, this tutorial creates some table for a data product for a customer 360 profiling. The final solution is visible in <a href="https://github.com/jbcodeforce/flink_project_demos/tree/main/customer_360/c360_flink_processing">this git repo</a></p> <ul> <li>As a Data Engineer the environment variables should be set to point to the created project <div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FLINK_PROJECT</span><span class="o">=</span><span class="nv">$HOME</span>/Code/dsp
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PIPELINES</span><span class="o">=</span><span class="nv">$FLINK_PROJECT</span>/pipelines
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">STAGING</span><span class="o">=</span><span class="nv">$FLINK_PROJECT</span>/staging
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="nv">$FLINK_PROJECT</span>/config.yaml<span class="w">   </span><span class="c1"># see Setup Lab</span>
</span></code></pre></div></li> <li> <p>The command to add a table in the context of the <code>c360</code> data product is: <div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>shift_left<span class="w"> </span>table<span class="w"> </span>init<span class="w"> </span>src_customers<span class="w"> </span><span class="nv">$PIPELINES</span>/sources<span class="w"> </span>--product-name<span class="w"> </span>c360
</span></code></pre></div></p> </li> <li> <p>Now the folder tree looks like this: <div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>├──<span class="w"> </span>pipelines
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>│<span class="w">   </span>├──<span class="w"> </span>common.mk
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>│<span class="w">   </span>├──<span class="w"> </span>dimensions
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>│<span class="w">   </span>├──<span class="w"> </span>facts
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>│<span class="w">   </span>├──<span class="w"> </span>intermediates
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>│<span class="w">   </span>├──<span class="w"> </span>sources
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>c360
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>│<span class="w">   </span>│<span class="w">       </span>└──<span class="w"> </span>src_customers
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>│<span class="w">   </span>│<span class="w">           </span>├──<span class="w"> </span>Makefile
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>│<span class="w">   </span>│<span class="w">           </span>├──<span class="w"> </span>sql-scripts
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>│<span class="w">   </span>│<span class="w">           </span>│<span class="w">   </span>├──<span class="w"> </span>ddl.src_c360_customers.sql
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>│<span class="w">   </span>│<span class="w">           </span>│<span class="w">   </span>├──<span class="w"> </span>dml.src_c360_customers.properties
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>│<span class="w">   </span>│<span class="w">           </span>│<span class="w">   </span>└──<span class="w"> </span>dml.src_c360_customers.sql
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>│<span class="w">   </span>│<span class="w">           </span>├──<span class="w"> </span>tests
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>│<span class="w">   </span>│<span class="w">           </span>└──<span class="w"> </span>tracking.md
</span></code></pre></div></p> </li> </ul> <p><em>The approach to have DDL and DML in different files, to separate the table creation from the insertion logic, is to avoid droping the table each time there is a change to the logic, which happen quite often during Flink SQL development.</em></p> <h3 id="update-the-ddl-content">Update the DDL content<a class="headerlink" href="#update-the-ddl-content" title="Permanent link">¶</a></h3> <p>Change the DDL content in the file: <code>ddl.src_c360_customers.sql</code> to the following content:</p> <div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">src_c360_customers</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="n">first_name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="n">last_name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="n">date_of_birth</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="n">gender</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="n">registration_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="n">customer_segment</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="n">preferred_channel</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="n">address_line1</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="n">city</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">    </span><span class="n">zip_code</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="n">age_years</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="n">days_since_registration</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">    </span><span class="n">generation_segment</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="n">missing_email_flag</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="n">missing_phone_flag</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span id="__span-6-22"><a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">ENFORCED</span>
</span><span id="__span-6-23"><a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="p">)</span><span class="w"> </span><span class="n">DISTRIBUTED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">HASH</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">BUCKETS</span>
</span><span id="__span-6-24"><a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-25"><a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="s1">'changelog.mode'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'upsert'</span><span class="p">,</span>
</span><span id="__span-6-26"><a href="#__codelineno-6-26" id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="s1">'key.avro-registry.schema-context'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'.flink-dev'</span><span class="p">,</span>
</span><span id="__span-6-27"><a href="#__codelineno-6-27" id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="s1">'value.avro-registry.schema-context'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'.flink-dev'</span><span class="p">,</span>
</span><span id="__span-6-28"><a href="#__codelineno-6-28" id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="s1">'key.format'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'avro-registry'</span><span class="p">,</span>
</span><span id="__span-6-29"><a href="#__codelineno-6-29" id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="s1">'value.format'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'avro-registry'</span><span class="p">,</span>
</span><span id="__span-6-30"><a href="#__codelineno-6-30" id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="s1">'kafka.retention.time'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'0'</span><span class="p">,</span>
</span><span id="__span-6-31"><a href="#__codelineno-6-31" id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="s1">'kafka.producer.compression.type'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'snappy'</span><span class="p">,</span>
</span><span id="__span-6-32"><a href="#__codelineno-6-32" id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="s1">'scan.bounded.mode'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'unbounded'</span><span class="p">,</span>
</span><span id="__span-6-33"><a href="#__codelineno-6-33" id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="s1">'scan.startup.mode'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'earliest-offset'</span><span class="p">,</span>
</span><span id="__span-6-34"><a href="#__codelineno-6-34" id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="s1">'value.fields-include'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'all'</span>
</span><span id="__span-6-35"><a href="#__codelineno-6-35" id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="p">);</span>
</span></code></pre></div> <p>The table is upsert changelog mode with a primary key, so records will be deduplicated automatically by the Flink engine. As multiple Kafka Clusters are defined in Confluent Cloud environment, and there is one schema registry in the environement, this is good practice to isolate the schema-context in the schema registry. <a href="https://docs.confluent.io/platform/current/schema-registry/schema-contexts-cp.html">See product schema-context documentation</a>.</p> <h3 id="update-the-dml-content">Update the DML content<a class="headerlink" href="#update-the-dml-content" title="Permanent link">¶</a></h3> <p>Do the same for the <code>dml.src_c360_customers.sql</code>:</p> <div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">src_c360_customers</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="n">first_name</span><span class="p">,</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="n">last_name</span><span class="p">,</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="n">email</span><span class="p">,</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="n">phone</span><span class="p">,</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="n">date_of_birth</span><span class="p">,</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="n">gender</span><span class="p">,</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="n">registration_date</span><span class="p">,</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="n">customer_segment</span><span class="p">,</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="n">preferred_channel</span><span class="p">,</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="n">address_line1</span><span class="p">,</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="n">city</span><span class="p">,</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">    </span><span class="k">state</span><span class="p">,</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">    </span><span class="n">zip_code</span><span class="p">,</span>
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">    </span><span class="n">country</span><span class="p">,</span>
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">    </span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">date_of_birth</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="w"> </span><span class="n">event_ts</span><span class="p">)</span><span class="w"> </span><span class="n">age_years</span><span class="p">,</span>
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">    </span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">registration_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="w"> </span><span class="n">event_ts</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">days_since_registration</span><span class="p">,</span>
</span><span id="__span-7-20"><a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">     </span><span class="k">CASE</span>
</span><span id="__span-7-21"><a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">date_of_birth</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="w"> </span><span class="n">event_ts</span><span class="p">)</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Gen Z'</span>
</span><span id="__span-7-22"><a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">date_of_birth</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="w"> </span><span class="n">event_ts</span><span class="p">)</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Millennial'</span>
</span><span id="__span-7-23"><a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">date_of_birth</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="w"> </span><span class="n">event_ts</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Gen X'</span>
</span><span id="__span-7-24"><a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Boomer+'</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">generation_segment</span><span class="p">,</span>
</span><span id="__span-7-25"><a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="k">CASE</span>
</span><span id="__span-7-26"><a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-7-27"><a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">        </span><span class="k">OR</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-7-28"><a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">missing_email_flag</span><span class="p">,</span>
</span><span id="__span-7-29"><a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">     </span><span class="k">CASE</span>
</span><span id="__span-7-30"><a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">phone</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-7-31"><a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">        </span><span class="k">OR</span><span class="w"> </span><span class="n">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-7-32"><a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">missing_phone_flag</span>
</span><span id="__span-7-33"><a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="k">FROM</span><span class="w"> </span><span class="n">customers_raw</span>
</span></code></pre></div> <p>It is possible for a Data Engineer to use VsCode to develop those SQL statements using the <a href="https://docs.confluent.io/cloud/current/client-apps/vs-code-extension.html">Confluent VScode extension</a>. </p> <p>The natural way to develop DML is to use the Confluent Cloud Workspace and build the SQL iteratively, by looking at data, build CTEs and then final <code>insert into</code></p> <figure> <img alt="" src="../images/cc_wkspace.png"/> </figure> <p>Copy/paste the above DML will fail as the <code>customers_raw</code> is not created. As seen in previous section, in real-life the Kafka dev cluster may have real data created by replicating source topics, like a <code>customers_raw</code> topic. In this tutorial we need to create the table, we will do that in next section.</p> <p>The <code>shift_left</code> tool has also created a Makefile for each table so Data engineer may use <code>make</code> to deploy DDL and DML. The makefile encapsulates the <code>confluent cli</code> commands to simplify memorizing the commands with simple common verbs to work on Flink statement:</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>make<span class="w"> </span>create_flink_ddl
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>make<span class="w"> </span>create_flink_dml
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>make<span class="w"> </span>describe_flink_ddl
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>make<span class="w"> </span>pause_flink_dml
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>make<span class="w"> </span>resume_flink_dml
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>make<span class="w"> </span>drop_table
</span></code></pre></div> <p>Those verbs are the same for all tables.</p> <h2 id="adding-unit-tests">Adding unit tests<a class="headerlink" href="#adding-unit-tests" title="Permanent link">¶</a></h2> <p><code>shift_left</code> includes a test harness command to introspecte the SQL and to create synthetic data.</p> <ul> <li> <p>The first thing to do is to get a table inventory up-to-date so the tool can search parent definition of the table under tests. <div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>shift_left<span class="w"> </span>table<span class="w"> </span>build-inventory
</span></code></pre></div></p> <p>This command creates an inventory.json under the $PIPELINES folder. This file is a map <table_name, reference_data="">: <div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nt">"src_c360_customers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_c360_customers"</span><span class="p">,</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source"</span><span class="p">,</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers/sql-scripts/dml.src_c360_customers.sql"</span><span class="p">,</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers/sql-scripts/ddl.src_c360_customers.sql"</span><span class="p">,</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="nt">"table_folder_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers"</span>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="p">},</span>
</span></code></pre></div></table_name,></p> <p>That file does not need to be commited to the git remote, as the CI/CD process will recreate it at each Pull Requests.</p> </li> <li> <p>Run the following command: <div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>shift_left<span class="w"> </span>table<span class="w"> </span>init-unit-tests<span class="w"> </span>src_customers<span class="w"> </span>--nb-test-cases<span class="w"> </span><span class="m">1</span>
</span></code></pre></div></p> </li> </ul> <p>This will create a set of files under the tests folder:</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>│<span class="w">   </span>├──<span class="w"> </span>sources
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>c360
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>│<span class="w">   </span>│<span class="w">       </span>├──<span class="w"> </span>src_customers
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>Makefile
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>pipeline_definition.json
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>sql-scripts
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ddl.src_c360_customers.sql
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>dml.src_c360_customers.sql
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>tests
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ddl_customers_raw.sql
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>insert_customers_raw_1.sql
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>README.md
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>test_definitions.yaml
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a>│<span class="w">   </span>│<span class="w">       </span>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>validate_src_c360_customers_1.sql
</span></code></pre></div> <h3 id="run-unit-tests">Run unit tests<a class="headerlink" href="#run-unit-tests" title="Permanent link">¶</a></h3> <p>Execute unit tests for a table by sending data to <code>_ut</code> topics and validating results. By default runs insert SQL and foundation steps; use <code>--run-all</code> to also run validation SQL. The test suite report is saved as JSON under the session log directory.</p> <table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>table_name</code></td> <td>(required)</td> <td>Table to run tests for</td> </tr> <tr> <td><code>--test-case-name</code></td> <td>(all)</td> <td>Run only this test case (e.g. <code>_1</code>)</td> </tr> <tr> <td><code>--run-all</code></td> <td><code>False</code></td> <td>Also run validation SQL</td> </tr> <tr> <td><code>--compute-pool-id</code></td> <td>config</td> <td>Flink compute pool (env: <code>CPOOL_ID</code>)</td> </tr> <tr> <td><code>--post-fix-unit-test</code></td> <td>config or <code>_ut</code></td> <td>Suffix for UT topics (e.g. <code>_ut</code>, <code>_foo</code>). Must start with <code>_</code>, then 2–3 alphanumeric characters</td> </tr> </tbody> </table> <div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Run all unit tests for the table (inserts and foundations only)</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>shift_left<span class="w"> </span>table<span class="w"> </span>run-unit-tests<span class="w"> </span>src_c360_customers
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="c1"># Run a specific test case and include validation</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>shift_left<span class="w"> </span>table<span class="w"> </span>run-unit-tests<span class="w"> </span>src_c360_customers<span class="w"> </span>--test-case-name<span class="w"> </span>_1<span class="w"> </span>--run-all
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="c1"># Use a dedicated compute pool and topic suffix</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a>shift_left<span class="w"> </span>table<span class="w"> </span>run-unit-tests<span class="w"> </span>src_c360_customers<span class="w"> </span>--compute-pool-id<span class="w"> </span>&lt;pool_id&gt;<span class="w"> </span>--post-fix-unit-test<span class="w"> </span>_ut
</span></code></pre></div> <p>Related commands:</p> <ul> <li><strong>run-validation-tests</strong> (or <strong>validate-unit-tests</strong>): Run only the validation SQL for the table. Same options as run-unit-tests.</li> <li><strong>delete-unit-tests</strong>: Remove Flink statements and Kafka topics created for the table's unit tests. Options: <code>--compute-pool-id</code>, <code>--post-fix-unit-test</code>.</li> </ul> <p>To deploy DDL and DML to Confluent Cloud (create/run Flink statements), see <a href="../../pipeline_mgr/">Pipeline Management</a> and <a href="../../blue_green_deploy/">Blue/Green Deployment</a>.</p> <h2 id="project-admin-work">Project Admin Work<a class="headerlink" href="#project-admin-work" title="Permanent link">¶</a></h2> <h3 id="build-table-inventory">Build table inventory<a class="headerlink" href="#build-table-inventory" title="Permanent link">¶</a></h3> <p>The following command will create a json file under the $PIPELINES folder of all the tables defined in the repository. <div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>shift_left<span class="w"> </span>table<span class="w"> </span>build-inventory
</span></code></pre></div></p> <h3 id="validate-config">Validate config<a class="headerlink" href="#validate-config" title="Permanent link">¶</a></h3> <p>Check that the config file (from <code>CONFIG_FILE</code>) is valid before running other project or pipeline commands.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>validate-config
</span></code></pre></div> <h3 id="build-table-relationships">Build Table RelationShips<a class="headerlink" href="#build-table-relationships" title="Permanent link">¶</a></h3> <p>For each table created by Flink statement, it is easy by parsing the SQL statement to know the direct parents using the JOINS, FROM clauses. The following command creates a <code>pipeline_definition.json</code> file for each table that includes the parent list and also assess the complexity of the statement so we could compute the global complexity of a data product.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>shift_left<span class="w"> </span>pipeline<span class="w"> </span>build-all-metadata
</span></code></pre></div> <p>When crawling the complete repository the tool updates each table's pipeline_definition.json children list when this table is parent of another. </p> <p>This element is crucial to manage a end-to-end pipeline. The following example comes from this <a href="https://github.com/jbcodeforce/flink_project_demos/tree/main/customer_360/c360_flink_processing">repository with a customer 360 data analytics product</a></p> <div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">{</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">   </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dim_c360_customer_transactions"</span><span class="p">,</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">   </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">   </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"intermediate"</span><span class="p">,</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">   </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/intermediates/c360/int_customer_transactions/sql-scripts/dml.int_c360_customer_transactions.sql"</span><span class="p">,</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">   </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/intermediates/c360/int_customer_transactions/sql-scripts/ddl.int_c360_customer_transactions.sql"</span><span class="p">,</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">   </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/intermediates/c360/int_customer_transactions"</span><span class="p">,</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">   </span><span class="nt">"complexity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">      </span><span class="nt">"number_of_regular_joins"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">      </span><span class="nt">"number_of_left_joins"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">      </span><span class="nt">"number_of_right_joins"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">      </span><span class="nt">"number_of_inner_joins"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">      </span><span class="nt">"number_of_outer_joins"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">      </span><span class="nt">"complexity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Medium"</span><span class="p">,</span>
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">      </span><span class="nt">"state_form"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stateful"</span>
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">   </span><span class="p">},</span>
</span><span id="__span-17-17"><a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">   </span><span class="nt">"parents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-18"><a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-19"><a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">         </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_c360_tx_items"</span><span class="p">,</span>
</span><span id="__span-17-20"><a href="#__codelineno-17-20" id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">         </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-21"><a href="#__codelineno-17-21" id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">         </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source"</span><span class="p">,</span>
</span><span id="__span-17-22"><a href="#__codelineno-17-22" id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">         </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_tx_items/sql-scripts/dml.src_c360_tx_items.sql"</span><span class="p">,</span>
</span><span id="__span-17-23"><a href="#__codelineno-17-23" id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">         </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_tx_items/sql-scripts/ddl.src_c360_tx_items.sql"</span><span class="p">,</span>
</span><span id="__span-17-24"><a href="#__codelineno-17-24" id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">         </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_tx_items"</span>
</span><span id="__span-17-25"><a href="#__codelineno-17-25" id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-17-26"><a href="#__codelineno-17-26" id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-27"><a href="#__codelineno-17-27" id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="w">         </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_c360_transactions"</span><span class="p">,</span>
</span><span id="__span-17-28"><a href="#__codelineno-17-28" id="__codelineno-17-28" name="__codelineno-17-28"></a><span class="w">         </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-29"><a href="#__codelineno-17-29" id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="w">         </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source"</span><span class="p">,</span>
</span><span id="__span-17-30"><a href="#__codelineno-17-30" id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="w">         </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_transactions/sql-scripts/dml.src_c360_transactions.sql"</span><span class="p">,</span>
</span><span id="__span-17-31"><a href="#__codelineno-17-31" id="__codelineno-17-31" name="__codelineno-17-31"></a><span class="w">         </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_transactions/sql-scripts/ddl.src_c360_transactions.sql"</span><span class="p">,</span>
</span><span id="__span-17-32"><a href="#__codelineno-17-32" id="__codelineno-17-32" name="__codelineno-17-32"></a><span class="w">         </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_transactions"</span>
</span><span id="__span-17-33"><a href="#__codelineno-17-33" id="__codelineno-17-33" name="__codelineno-17-33"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-17-34"><a href="#__codelineno-17-34" id="__codelineno-17-34" name="__codelineno-17-34"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-35"><a href="#__codelineno-17-35" id="__codelineno-17-35" name="__codelineno-17-35"></a><span class="w">         </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_c360_customers"</span><span class="p">,</span>
</span><span id="__span-17-36"><a href="#__codelineno-17-36" id="__codelineno-17-36" name="__codelineno-17-36"></a><span class="w">         </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-37"><a href="#__codelineno-17-37" id="__codelineno-17-37" name="__codelineno-17-37"></a><span class="w">         </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source"</span><span class="p">,</span>
</span><span id="__span-17-38"><a href="#__codelineno-17-38" id="__codelineno-17-38" name="__codelineno-17-38"></a><span class="w">         </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers/sql-scripts/dml.src_c360_customers.sql"</span><span class="p">,</span>
</span><span id="__span-17-39"><a href="#__codelineno-17-39" id="__codelineno-17-39" name="__codelineno-17-39"></a><span class="w">         </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers/sql-scripts/ddl.src_c360_customers.sql"</span><span class="p">,</span>
</span><span id="__span-17-40"><a href="#__codelineno-17-40" id="__codelineno-17-40" name="__codelineno-17-40"></a><span class="w">         </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_customers"</span>
</span><span id="__span-17-41"><a href="#__codelineno-17-41" id="__codelineno-17-41" name="__codelineno-17-41"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-17-42"><a href="#__codelineno-17-42" id="__codelineno-17-42" name="__codelineno-17-42"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-43"><a href="#__codelineno-17-43" id="__codelineno-17-43" name="__codelineno-17-43"></a><span class="w">         </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_c360_products"</span><span class="p">,</span>
</span><span id="__span-17-44"><a href="#__codelineno-17-44" id="__codelineno-17-44" name="__codelineno-17-44"></a><span class="w">         </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-45"><a href="#__codelineno-17-45" id="__codelineno-17-45" name="__codelineno-17-45"></a><span class="w">         </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source"</span><span class="p">,</span>
</span><span id="__span-17-46"><a href="#__codelineno-17-46" id="__codelineno-17-46" name="__codelineno-17-46"></a><span class="w">         </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_products/sql-scripts/dml.src_c360_products.sql"</span><span class="p">,</span>
</span><span id="__span-17-47"><a href="#__codelineno-17-47" id="__codelineno-17-47" name="__codelineno-17-47"></a><span class="w">         </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_products/sql-scripts/ddl.src_c360_products.sql"</span><span class="p">,</span>
</span><span id="__span-17-48"><a href="#__codelineno-17-48" id="__codelineno-17-48" name="__codelineno-17-48"></a><span class="w">         </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/sources/c360/src_products"</span><span class="p">,</span>
</span><span id="__span-17-49"><a href="#__codelineno-17-49" id="__codelineno-17-49" name="__codelineno-17-49"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-17-50"><a href="#__codelineno-17-50" id="__codelineno-17-50" name="__codelineno-17-50"></a><span class="w">   </span><span class="p">],</span>
</span><span id="__span-17-51"><a href="#__codelineno-17-51" id="__codelineno-17-51" name="__codelineno-17-51"></a><span class="w">   </span><span class="nt">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-52"><a href="#__codelineno-17-52" id="__codelineno-17-52" name="__codelineno-17-52"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-53"><a href="#__codelineno-17-53" id="__codelineno-17-53" name="__codelineno-17-53"></a><span class="w">         </span><span class="nt">"table_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360_fct_customer_profile"</span><span class="p">,</span>
</span><span id="__span-17-54"><a href="#__codelineno-17-54" id="__codelineno-17-54" name="__codelineno-17-54"></a><span class="w">         </span><span class="nt">"product_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c360"</span><span class="p">,</span>
</span><span id="__span-17-55"><a href="#__codelineno-17-55" id="__codelineno-17-55" name="__codelineno-17-55"></a><span class="w">         </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fact"</span><span class="p">,</span>
</span><span id="__span-17-56"><a href="#__codelineno-17-56" id="__codelineno-17-56" name="__codelineno-17-56"></a><span class="w">         </span><span class="nt">"dml_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/facts/c360/fct_customer_360_profile/sql-scripts/dml.c360_fct_customer_profile.sql"</span><span class="p">,</span>
</span><span id="__span-17-57"><a href="#__codelineno-17-57" id="__codelineno-17-57" name="__codelineno-17-57"></a><span class="w">         </span><span class="nt">"ddl_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/facts/c360/fct_customer_360_profile/sql-scripts/ddl.c360_fct_customer_profile.sql"</span><span class="p">,</span>
</span><span id="__span-17-58"><a href="#__codelineno-17-58" id="__codelineno-17-58" name="__codelineno-17-58"></a><span class="w">         </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipelines/facts/c360/fct_customer_360_profile"</span><span class="p">,</span>
</span><span id="__span-17-59"><a href="#__codelineno-17-59" id="__codelineno-17-59" name="__codelineno-17-59"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-17-60"><a href="#__codelineno-17-60" id="__codelineno-17-60" name="__codelineno-17-60"></a><span class="w">   </span><span class="p">]</span>
</span><span id="__span-17-61"><a href="#__codelineno-17-61" id="__codelineno-17-61" name="__codelineno-17-61"></a><span class="p">}</span>
</span></code></pre></div> <p>Here is a graph view for a view table of a data analytics product:</p> <figure> <img alt="" src="../images/graph_vire_flk_statements.png"/> </figure> <p>This graph can be built for any table using a command like:</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>shift_left<span class="w"> </span>pipeline<span class="w"> </span>report<span class="w"> </span>&lt;table_name&gt;
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="c1">#</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>shift_left<span class="w"> </span>pipeline<span class="w"> </span>report<span class="w">  </span>customer_analysis_c360<span class="w"> </span>--open
</span></code></pre></div> <h3 id="get-table-use-cross-data-product">Get Table Use Cross Data Product<a class="headerlink" href="#get-table-use-cross-data-product" title="Permanent link">¶</a></h3> <p>When project grows in number of Flink Statements so table, it will be interesting to get the list of tables that may be used by more than one product. The command writes the list to <code>table_cross_products.txt</code> under <code>~/.shift_left/</code>.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>report-table-cross-products
</span></code></pre></div> <h3 id="list-tables-with-one-child">List tables with one child<a class="headerlink" href="#list-tables-with-one-child" title="Permanent link">¶</a></h3> <p>Report tables that have exactly one child table. Useful for pipeline simplification or refactoring. The list is written to <code>tables_with_one_child.txt</code> under <code>~/.shift_left/</code>.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>list-tables-with-one-child
</span></code></pre></div> <p>Table with single descendant may be good candidate to become CTEs for the child table.</p> <h3 id="getting-the-list-of-compute-pools">Getting the list of compute pools<a class="headerlink" href="#getting-the-list-of-compute-pools" title="Permanent link">¶</a></h3> <p>Getting current CFU utilization and the list of all compute pools</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>list-compute-pools
</span></code></pre></div> <p>The response looks like: <div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="err">Compu</span><span class="kc">te</span><span class="err">PoolLis</span><span class="kc">t</span><span class="err">(</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="err">crea</span><span class="kc">te</span><span class="err">d_a</span><span class="kc">t</span><span class="err">=da</span><span class="kc">tet</span><span class="err">ime.da</span><span class="kc">tet</span><span class="err">ime(</span><span class="mi">2026</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">52</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">327409</span><span class="err">)</span><span class="p">,</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="err">pools=</span><span class="p">[</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">        </span><span class="err">Compu</span><span class="kc">te</span><span class="err">PoolI</span><span class="kc">nf</span><span class="err">o(</span>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">            </span><span class="err">id='l</span><span class="kc">f</span><span class="err">cp</span><span class="mf">-....</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">            </span><span class="kc">na</span><span class="err">me='dev</span><span class="mi">-</span><span class="err">src</span><span class="mi">-</span><span class="err">sdp</span><span class="mi">-</span><span class="err">shipme</span><span class="kc">nts</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">            </span><span class="err">e</span><span class="kc">n</span><span class="err">v_id='e</span><span class="kc">n</span><span class="err">v</span><span class="mf">-....</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">            </span><span class="err">max_c</span><span class="kc">fu</span><span class="err">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">            </span><span class="err">regio</span><span class="kc">n</span><span class="err">='us</span><span class="mi">-</span><span class="err">wes</span><span class="kc">t</span><span class="mi">-2</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">            </span><span class="err">s</span><span class="kc">tatus</span><span class="err">_phase='PROVISIONED'</span><span class="p">,</span>
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">            </span><span class="err">curre</span><span class="kc">nt</span><span class="err">_c</span><span class="kc">fu</span><span class="err">=</span><span class="mi">1</span>
</span><span id="__span-22-12"><a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">        </span><span class="err">)</span><span class="p">,</span>
</span><span id="__span-22-13"><a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">        </span><span class="err">Compu</span><span class="kc">te</span><span class="err">PoolI</span><span class="kc">nf</span><span class="err">o(</span>
</span><span id="__span-22-14"><a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">            </span><span class="err">id='l</span><span class="kc">f</span><span class="err">cp</span><span class="mf">-....</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-15"><a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">            </span><span class="kc">na</span><span class="err">me='da</span><span class="kc">ta</span><span class="mi">-</span><span class="err">ge</span><span class="kc">nerat</span><span class="err">io</span><span class="kc">n</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-16"><a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">            </span><span class="err">e</span><span class="kc">n</span><span class="err">v_id='e</span><span class="kc">n</span><span class="err">v</span><span class="mf">-....</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-17"><a href="#__codelineno-22-17" id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">            </span><span class="err">max_c</span><span class="kc">fu</span><span class="err">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-22-18"><a href="#__codelineno-22-18" id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">            </span><span class="err">regio</span><span class="kc">n</span><span class="err">='us</span><span class="mi">-</span><span class="err">wes</span><span class="kc">t</span><span class="mi">-2</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-22-19"><a href="#__codelineno-22-19" id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">            </span><span class="err">s</span><span class="kc">tatus</span><span class="err">_phase='PROVISIONED'</span><span class="p">,</span>
</span><span id="__span-22-20"><a href="#__codelineno-22-20" id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">            </span><span class="err">curre</span><span class="kc">nt</span><span class="err">_c</span><span class="kc">fu</span><span class="err">=</span><span class="mi">0</span>
</span><span id="__span-22-21"><a href="#__codelineno-22-21" id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">        </span><span class="err">)</span><span class="p">]</span>
</span></code></pre></div></p> <h3 id="getting-the-list-of-statements-running-in-a-compute-pool">Getting the list of statements running in a compute pool<a class="headerlink" href="#getting-the-list-of-statements-running-in-a-compute-pool" title="Permanent link">¶</a></h3> <p>List Flink statements in a given compute pool. Output includes statement name, status (e.g. RUNNING), compute pool ID, and catalog/database.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>get-statement-list<span class="w"> </span>&lt;compute_pool_id&gt;
</span></code></pre></div> <p>Here is an extracted content for one statement:</p> <div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="err">'dev</span><span class="mi">-</span><span class="err">usw</span><span class="mi">2-</span><span class="err">c</span><span class="mi">360-</span><span class="err">dml</span><span class="mi">-</span><span class="err">src</span><span class="mi">-</span><span class="err">c</span><span class="mi">360-</span><span class="kc">t</span><span class="err">x</span><span class="mi">-</span><span class="err">i</span><span class="kc">te</span><span class="err">ms'</span><span class="p">:</span><span class="w"> </span><span class="err">S</span><span class="kc">tate</span><span class="err">me</span><span class="kc">nt</span><span class="err">I</span><span class="kc">nf</span><span class="err">o(</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="kc">na</span><span class="err">me='dev</span><span class="mi">-</span><span class="err">usw</span><span class="mi">2-</span><span class="err">c</span><span class="mi">360-</span><span class="err">dml</span><span class="mi">-</span><span class="err">src</span><span class="mi">-</span><span class="err">c</span><span class="mi">360-</span><span class="kc">t</span><span class="err">x</span><span class="mi">-</span><span class="err">i</span><span class="kc">te</span><span class="err">ms'</span><span class="p">,</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">    </span><span class="err">s</span><span class="kc">tatus</span><span class="err">_phase='RUNNING'</span><span class="p">,</span>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="err">s</span><span class="kc">tatus</span><span class="err">_de</span><span class="kc">ta</span><span class="err">il=''</span><span class="p">,</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="err">sql_co</span><span class="kc">ntent</span><span class="err">='INSERT</span><span class="w"> </span><span class="err">INTO</span><span class="w"> </span><span class="err">src_c</span><span class="mi">360</span><span class="err">_</span><span class="kc">t</span><span class="err">x_i</span><span class="kc">te</span><span class="err">ms\</span><span class="kc">n</span><span class="err">SELECT</span><span class="w"> </span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="err">i</span><span class="kc">te</span><span class="err">m_id</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="kc">transa</span><span class="err">c</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">_id</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="err">produc</span><span class="kc">t</span><span class="err">_id</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="err">qua</span><span class="kc">nt</span><span class="err">i</span><span class="kc">t</span><span class="err">y</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="err">u</span><span class="kc">n</span><span class="err">i</span><span class="kc">t</span><span class="err">_price</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="err">li</span><span class="kc">ne</span><span class="err">_</span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">    </span><span class="err">discou</span><span class="kc">nt</span><span class="err">_applied\</span><span class="kc">n</span><span class="err">FROM</span><span class="w"> </span><span class="err">(\</span><span class="kc">n</span><span class="w">    </span><span class="err">SELECT</span><span class="w"> </span><span class="err">*</span><span class="p">,</span><span class="err">\</span><span class="kc">n</span><span class="w">        </span><span class="err">ROW_NUMBER()</span><span class="w"> </span><span class="err">OVER</span><span class="w"> </span><span class="err">(\</span><span class="kc">n</span><span class="w">            </span><span class="err">PARTITION</span><span class="w"> </span><span class="err">BY</span><span class="w"> </span><span class="err">i</span><span class="kc">te</span><span class="err">m_id</span><span class="w"> </span><span class="err">\</span><span class="kc">n</span><span class="w">            </span><span class="err">ORDER</span><span class="w"> </span><span class="err">BY</span><span class="w"> </span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="err">`$row</span><span class="kc">t</span><span class="err">ime`</span><span class="w"> </span><span class="err">DESC\</span><span class="kc">n</span><span class="w">        </span><span class="err">)</span><span class="w"> </span><span class="err">AS</span><span class="w"> </span><span class="err">row_</span><span class="kc">nu</span><span class="err">m\</span><span class="kc">n</span><span class="w">    </span><span class="err">FROM</span><span class="w"> </span><span class="kc">transa</span><span class="err">c</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">_i</span><span class="kc">te</span><span class="err">ms_raw\</span><span class="kc">n</span><span class="err">)\</span><span class="kc">n</span><span class="err">WHERE</span><span class="w"> </span><span class="err">row_</span><span class="kc">nu</span><span class="err">m</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span><span class="err">'</span><span class="p">,</span>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="err">compu</span><span class="kc">te</span><span class="err">_pool_id='l</span><span class="kc">f</span><span class="err">cp</span><span class="mi">-</span><span class="err">xvrvmz'</span><span class="p">,</span>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="err">compu</span><span class="kc">te</span><span class="err">_pool_</span><span class="kc">na</span><span class="err">me=No</span><span class="kc">ne</span><span class="p">,</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="err">crea</span><span class="kc">te</span><span class="err">d_a</span><span class="kc">t</span><span class="err">=da</span><span class="kc">tet</span><span class="err">ime.da</span><span class="kc">tet</span><span class="err">ime(</span><span class="mi">2026</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">286807</span><span class="p">,</span><span class="w"> </span><span class="kc">t</span><span class="err">zi</span><span class="kc">nf</span><span class="err">o=TzI</span><span class="kc">nf</span><span class="err">o(</span><span class="mi">0</span><span class="err">))</span><span class="p">,</span>
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">    </span><span class="err">pri</span><span class="kc">n</span><span class="err">cipal='u</span><span class="mi">-</span><span class="err">xg</span><span class="mi">2</span><span class="kc">n</span><span class="err">dz'</span><span class="p">,</span>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="err">sql_ca</span><span class="kc">tal</span><span class="err">og='j</span><span class="mi">9</span><span class="err">r</span><span class="mf">-e</span><span class="kc">n</span><span class="err">v'</span><span class="p">,</span>
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">    </span><span class="err">sql_da</span><span class="kc">ta</span><span class="err">base='j</span><span class="mi">9</span><span class="err">r</span><span class="mi">-</span><span class="err">ka</span><span class="kc">f</span><span class="err">ka'</span>
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="err">)</span><span class="p">,</span>
</span></code></pre></div> <h3 id="housekeep-statements">Housekeep statements<a class="headerlink" href="#housekeep-statements" title="Permanent link">¶</a></h3> <p>Clean up or manage Flink statements in two mutually exclusive ways.</p> <p><strong>Cleanup by filter:</strong> Delete statements matching name prefix, status, and age. Defaults: prefix <code>workspace</code>, statuses <code>COMPLETED</code> and <code>FAILED</code>, age <code>0</code> days. The prefix cannot start with reserved words: <code>dev</code>, <code>stage</code>, <code>prod</code>.</p> <table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>--starts-with</code></td> <td><code>workspace</code></td> <td>Delete only statements whose name starts with this string</td> </tr> <tr> <td><code>--status</code></td> <td><code>COMPLETED</code>, <code>FAILED</code></td> <td>One of: <code>COMPLETED</code>, <code>FAILED</code>, <code>STOPPED</code></td> </tr> <tr> <td><code>--age</code></td> <td><code>0</code></td> <td>Delete only statements at least this many days old</td> </tr> </tbody> </table> <div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Default: delete COMPLETED/FAILED statements named like "workspace*"</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>shift_left<span class="w"> </span>project<span class="w"> </span>housekeep-statements
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1"># Delete COMPLETED statements named like "workspace*" older than 7 days</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>shift_left<span class="w"> </span>project<span class="w"> </span>housekeep-statements<span class="w"> </span>--starts-with<span class="w"> </span>workspace<span class="w"> </span>--status<span class="w"> </span>COMPLETED<span class="w"> </span>--age<span class="w"> </span><span class="m">7</span>
</span></code></pre></div> <p>Here is an example of output: <div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>20260202_10:56:43<span class="w"> </span>Statement<span class="w"> </span>list<span class="w"> </span>has<span class="w"> </span><span class="m">90</span><span class="w"> </span>statements
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>20260202_10:56:43<span class="w"> </span>Clean<span class="w"> </span>statements<span class="w"> </span>starting<span class="w"> </span>with<span class="w"> </span><span class="o">[</span><span class="w"> </span>workspace<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span><span class="s1">'COMPLETED'</span><span class="o">]</span><span class="w"> </span>state,<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>age<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>20260202_10:56:43<span class="w"> </span>delete<span class="w"> </span>workspace-2025-12-20-010600-83d7913f-0db7-4509-be27-9ed218b29687<span class="w"> </span>COMPLETED
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>20260202_10:56:43<span class="w"> </span>delete<span class="w"> </span>workspace-2025-12-20-010600-a46b44d5-ed97-4b14-9228-f924a7a9c0d4<span class="w"> </span>COMPLETED
</span></code></pre></div></p> <p><strong>Pool-specific actions (with <code>--compute-pool-id</code>):</strong> Run an action on statements in a single compute pool. Requires <code>--action</code>. Do not use <code>--starts-with</code>, <code>--status</code>, or <code>--age</code> in this mode.</p> <table> <thead> <tr> <th>Option</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>--compute-pool-id</code></td> <td>Target compute pool ID</td> </tr> <tr> <td><code>--action</code></td> <td>One of: <code>PAUSE</code>, <code>RESUME</code>, <code>DELETE</code></td> </tr> <tr> <td><code>--statement-name</code></td> <td>Optional; limit to one statement. Required when <code>--action</code> is <code>RESUME</code></td> </tr> </tbody> </table> <ul> <li><strong>PAUSE:</strong> Pause RUNNING statements (skips non-running).</li> <li><strong>RESUME:</strong> Resume STOPPED statements; requires <code>--statement-name</code>.</li> <li><strong>DELETE:</strong> Delete all statements in the pool (optionally filtered by <code>--statement-name</code>).</li> </ul> <div class="language-sh highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Pause all running statements in a pool</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>shift_left<span class="w"> </span>project<span class="w"> </span>housekeep-statements<span class="w"> </span>--compute-pool-id<span class="w"> </span>&lt;pool_id&gt;<span class="w"> </span>--action<span class="w"> </span>PAUSE
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="c1"># Resume a specific stopped statement</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a>shift_left<span class="w"> </span>project<span class="w"> </span>housekeep-statements<span class="w"> </span>--compute-pool-id<span class="w"> </span>&lt;pool_id&gt;<span class="w"> </span>--action<span class="w"> </span>RESUME<span class="w"> </span>--statement-name<span class="w"> </span>&lt;name&gt;
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="c1"># Delete all statements in a pool</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a>shift_left<span class="w"> </span>project<span class="w"> </span>housekeep-statements<span class="w"> </span>--compute-pool-id<span class="w"> </span>&lt;pool_id&gt;<span class="w"> </span>--action<span class="w"> </span>DELETE
</span></code></pre></div> <h3 id="list-modified-files">List modified files<a class="headerlink" href="#list-modified-files" title="Permanent link">¶</a></h3> <p>List files modified in the current git branch compared to a base branch. By default filters for SQL files and files modified since a given date. Writes affected table names to a file under <code>~/.shift_left/</code> (default: <code>modified_flink_files.txt</code>). Use this to decide which Flink statements to redeploy in a blue-green deployment.</p> <table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>branch_name</code></td> <td>(required)</td> <td>Base branch to compare (e.g. <code>main</code>, <code>origin/main</code>)</td> </tr> <tr> <td><code>--project-path</code></td> <td><code>.</code></td> <td>Git repository path</td> </tr> <tr> <td><code>--file-filter</code></td> <td><code>.sql</code></td> <td>File extension to include</td> </tr> <tr> <td><code>--since</code></td> <td><code>2025-12-01</code></td> <td>Only files modified on or after this date (YYYY-MM-DD)</td> </tr> </tbody> </table> <div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Compare current branch to main, SQL files only</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>shift_left<span class="w"> </span>project<span class="w"> </span>list-modified-files<span class="w"> </span>main
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="c1"># Limit to files changed since a date</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a>shift_left<span class="w"> </span>project<span class="w"> </span>list-modified-files<span class="w"> </span>origin/main<span class="w"> </span>--since<span class="w"> </span><span class="m">2026</span>-01-01
</span></code></pre></div> <h3 id="orphan-and-unused-tables">Orphan and unused tables<a class="headerlink" href="#orphan-and-unused-tables" title="Permanent link">¶</a></h3> <p>During the life cycle of the project, it may be possible that some tables were created and not deleted. Getting the list of topics in a given Kafka cluster may give a first level of information but this is not enough. The git repository includes an inventory of all the tables and getting the list of tables can be done as seen before.</p> <p>To find Flink SQL tables that are not referenced by any running DML statement, the command reads the table inventory and pipeline metadata (parent/child from <code>pipeline_definition.json</code>), compares them to running Flink statements, and reports tables that appear unused. Optionally it compares Kafka topics to list topics that have no corresponding running statement.</p> <p>Use this to identify tables or topics that can be retired or to spot tables that are unused but still have children (indirect use).</p> <table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>inventory_path</code></td> <td><code>PIPELINES</code></td> <td>Pipeline path where tables are defined</td> </tr> <tr> <td><code>--include-topics</code> / <code>--no-topics</code></td> <td><code>True</code></td> <td>Include unused Kafka topics in the report</td> </tr> <tr> <td><code>--output-file</code></td> <td><code>~/.shift_left/unused_tables_&lt;timestamp&gt;.txt</code></td> <td>Path for the results file</td> </tr> </tbody> </table> <p>Output includes a summary count, a table of unused tables (name, type, product, has children, path), and if requested a list of unused topics. Source tables and tables that have children are called out because they may be used indirectly. Results are also written to the output file.</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Use PIPELINES; include topics; default output file</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>shift_left<span class="w"> </span>project<span class="w"> </span>assess-unused-tables
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="c1"># Custom path and output file; skip topic check</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a>shift_left<span class="w"> </span>project<span class="w"> </span>assess-unused-tables<span class="w"> </span><span class="nv">$PIPELINES</span><span class="w"> </span>--no-topics<span class="w"> </span>--output-file<span class="w"> </span>./unused.txt
</span></code></pre></div> <p>Example of report:</p> <p>The full report includes an "Unused Tables" section (table name, type, product, has children, path) and, when <code>--include-topics</code> is set, an "Unused Topics" section. Below is an example of the topics table:</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a>┏━━━━━━━━━━━━━━━━━━━━━━━┓
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>┃<span class="w"> </span>Topic<span class="w"> </span>Name<span class="w">            </span>┃
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a>┡━━━━━━━━━━━━━━━━━━━━━━━┩
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a>│<span class="w"> </span>app_usage_raw<span class="w">         </span>│
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a>│<span class="w"> </span>append_tx<span class="w">             </span>│
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a>│<span class="w"> </span>customers<span class="w">             </span>│
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a>│<span class="w"> </span>customers_dedup<span class="w">       </span>│
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a>│<span class="w"> </span>customers_faker<span class="w">       </span>│
</span><span id="__span-30-9"><a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a>│<span class="w"> </span>customers_filteres<span class="w">    </span>│
</span><span id="__span-30-10"><a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a>│<span class="w"> </span>customers_raw<span class="w">         </span>│
</span><span id="__span-30-11"><a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a>│<span class="w"> </span>discounts_faker<span class="w">       </span>│
</span><span id="__span-30-12"><a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a>│<span class="w"> </span>group_hierarchy<span class="w">       </span>│
</span><span id="__span-30-13"><a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a>│<span class="w"> </span>groups_salted<span class="w">         </span>│
</span><span id="__span-30-14"><a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a>│<span class="w"> </span>loyalty_program_raw<span class="w">   </span>│
</span><span id="__span-30-15"><a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a>│<span class="w"> </span>page_views_1m<span class="w">         </span>│
</span><span id="__span-30-16"><a href="#__codelineno-30-16" id="__codelineno-30-16" name="__codelineno-30-16"></a>│<span class="w"> </span>products_raw<span class="w">          </span>│
</span><span id="__span-30-17"><a href="#__codelineno-30-17" id="__codelineno-30-17" name="__codelineno-30-17"></a>│<span class="w"> </span>src_tx_customers<span class="w">      </span>│
</span><span id="__span-30-18"><a href="#__codelineno-30-18" id="__codelineno-30-18" name="__codelineno-30-18"></a>│<span class="w"> </span>src_tx_discounts<span class="w">      </span>│
</span><span id="__span-30-19"><a href="#__codelineno-30-19" id="__codelineno-30-19" name="__codelineno-30-19"></a>│<span class="w"> </span>src_tx_transactions<span class="w">   </span>│
</span><span id="__span-30-20"><a href="#__codelineno-30-20" id="__codelineno-30-20" name="__codelineno-30-20"></a>│<span class="w"> </span>suites_versioned<span class="w">      </span>│
</span><span id="__span-30-21"><a href="#__codelineno-30-21" id="__codelineno-30-21" name="__codelineno-30-21"></a>│<span class="w"> </span>support_ticket_raw<span class="w">    </span>│
</span><span id="__span-30-22"><a href="#__codelineno-30-22" id="__codelineno-30-22" name="__codelineno-30-22"></a>│<span class="w"> </span>test_a<span class="w">                </span>│
</span><span id="__span-30-23"><a href="#__codelineno-30-23" id="__codelineno-30-23" name="__codelineno-30-23"></a>│<span class="w"> </span>transaction_items_raw<span class="w"> </span>│
</span><span id="__span-30-24"><a href="#__codelineno-30-24" id="__codelineno-30-24" name="__codelineno-30-24"></a>│<span class="w"> </span>transactions<span class="w">          </span>│
</span><span id="__span-30-25"><a href="#__codelineno-30-25" id="__codelineno-30-25" name="__codelineno-30-25"></a>│<span class="w"> </span>transactions_faker<span class="w">    </span>│
</span><span id="__span-30-26"><a href="#__codelineno-30-26" id="__codelineno-30-26" name="__codelineno-30-26"></a>│<span class="w"> </span>truck_loads<span class="w">           </span>│
</span><span id="__span-30-27"><a href="#__codelineno-30-27" id="__codelineno-30-27" name="__codelineno-30-27"></a>│<span class="w"> </span>tx_raw<span class="w">                </span>│
</span><span id="__span-30-28"><a href="#__codelineno-30-28" id="__codelineno-30-28" name="__codelineno-30-28"></a>│<span class="w"> </span>unique_orders<span class="w">         </span>│
</span><span id="__span-30-29"><a href="#__codelineno-30-29" id="__codelineno-30-29" name="__codelineno-30-29"></a>│<span class="w"> </span>users<span class="w">                 </span>│
</span><span id="__span-30-30"><a href="#__codelineno-30-30" id="__codelineno-30-30" name="__codelineno-30-30"></a>│<span class="w"> </span>users_salted<span class="w">          </span>│
</span><span id="__span-30-31"><a href="#__codelineno-30-31" id="__codelineno-30-31" name="__codelineno-30-31"></a>│<span class="w"> </span>users_transform<span class="w">       </span>│
</span><span id="__span-30-32"><a href="#__codelineno-30-32" id="__codelineno-30-32" name="__codelineno-30-32"></a>└───────────────────────┘
</span></code></pre></div> <h3 id="drop-all-tables-from-a-list">Drop all tables from a list<a class="headerlink" href="#drop-all-tables-from-a-list" title="Permanent link">¶</a></h3> <p>As a continuation of assessing orphans, user needs to validate false-positive and update the reported text file accordingly. Once done the following command will call drop table on each of those table</p> <div class="language-sh highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a>shift_left<span class="w"> </span>project<span class="w"> </span>delete-unused-tables<span class="w"> </span>toremove.txt
</span></code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button class="md-top md-icon" data-md-component="top" hidden="" type="button"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: Setup Lab" class="md-footer__link md-footer__link--prev" href="../setup_lab/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> Setup Lab </div> </div> </a> <a aria-label="Next: Migration AI Lab" class="md-footer__link md-footer__link--next" href="../migration_ai_lab/"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> Migration AI Lab </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Copyright © 2024-2026 Jerome Boyer </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> <div class="md-social"> <a class="md-social__link" href="https://github.com/jbcodeforce" rel="noopener" target="_blank" title="github.com"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> <a class="md-social__link" href="https://linkedin.com/in/jeromeboyer" rel="noopener" target="_blank" title="linkedin.com"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> <a class="md-social__link" href="" rel="noopener" target="_blank" title=""> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "search.suggest", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script> </body> </html>